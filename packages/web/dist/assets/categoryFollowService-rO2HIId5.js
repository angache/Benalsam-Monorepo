import{s as l,t as s}from"./auth-CRgK8rPx.js";const g=(r,e="Hata",t="Bir sorun oluÅŸtu")=>(console.error(`Error in ${e}:`,r),s({title:e,description:r?.message||t,variant:"destructive"}),null),k=(r,e)=>!r||!e?(s({title:"Eksik Bilgi",description:"KullanÄ±cÄ± ID'si veya kategori adÄ± eksik.",variant:"destructive"}),!1):!0,w=async(r,e)=>{if(!k(r,e))return null;try{const{data:t,error:i}=await l.from("user_followed_categories").insert([{user_id:r,category_name:e}]).select().single();return i?i.code==="23505"?(s({title:"Bilgi",description:"Bu kategoriyi zaten takip ediyorsunuz."}),{user_id:r,category_name:e,already_following:!0}):g(i,"Kategori Takip Edilemedi",i.message):(s({title:"Kategori Takip Edildi! ğŸ“Œ",description:`"${e}" kategorisi baÅŸarÄ±yla takip edildi.`}),t)}catch(t){return g(t,"Beklenmedik Hata","Kategori takip edilirken bir hata oluÅŸtu")}},v=async(r,e)=>{if(!k(r,e))return!1;try{const{error:t}=await l.from("user_followed_categories").delete().eq("user_id",r).eq("category_name",e);return t?g(t,"Kategori Takipten Ã‡Ä±kÄ±lamadÄ±",t.message):(s({title:"Kategori Takipten Ã‡Ä±kÄ±ldÄ±",description:`"${e}" kategorisi takipten Ã§Ä±karÄ±ldÄ±.`}),!0)}catch(t){return g(t,"Beklenmedik Hata","Kategori takipten Ã§Ä±karÄ±lÄ±rken bir hata oluÅŸtu")}},m=async r=>{if(!r)return[];try{const{data:e,error:t}=await l.from("user_followed_categories").select("category_name, created_at").eq("user_id",r).order("created_at",{ascending:!1});return t?(console.error("Error in fetchFollowedCategories:",t),[]):e||[]}catch(e){return console.error("Error in fetchFollowedCategories:",e),[]}},C=async(r,e=3,t=null)=>{if(!r)return[];try{const i=await m(r);return!i||i.length===0?[]:(await Promise.all(i.map(async a=>{const{data:_,error:d}=await l.from("listings").select("*, profiles (id, name, avatar_url, rating, total_ratings, rating_sum)").ilike("category",`${a.category_name}%`).order("created_at",{ascending:!1}).limit(e);if(d)return console.error(`Error fetching listings for category ${a.category_name}:`,d),{category_name:a.category_name,listings:[]};let n=_.map(c=>({...c,user:c.profiles,is_favorited:!1}));if(t&&n.length>0){const c=n.map(o=>o.id),{data:u,error:p}=await l.from("user_favorites").select("listing_id").eq("user_id",t).in("listing_id",c),f={};u&&u.forEach(o=>{f[o.listing_id]=!0}),n=n.map(o=>({...o,is_favorited:f[o.id]||!1}))}return{category_name:a.category_name,listings:n}}))).filter(a=>a.listings.length>0)}catch(i){return console.error("Unexpected error in fetchListingsForFollowedCategories:",i),s({title:"Beklenmedik Hata",description:"Takip edilen kategorilerin ilanlarÄ± yÃ¼klenirken bir hata oluÅŸtu.",variant:"destructive"}),[]}};export{C as a,w as f,v as u};
