import{j as e}from"./query-tMv1bFhv.js";import{r as n,L as U,d as P}from"./router-Bq68dJ36.js";import{B as h,t as N,e as $}from"./auth-CRgK8rPx.js";import{u as H,f as M,b as Y}from"./profile-Dy5Fyuz5.js";import{u as V,f as W,a as F}from"./categoryFollowService-rO2HIId5.js";import{A as R,f as G,g as X,aw as Z,L as q,D as J,b as Q,c as ee,d as se,e as te,S as ae,w as ie,x as re,y as le,ax as oe,z as ne,ay as ce}from"./listings-BLmNnY3e.js";import{m as S,Y as k,aI as de,i as _,ac as me,b4 as z,aH as xe,ah as K,b5 as ge,h as L}from"./ui-DwxUvrnm.js";import"./vendor-Bs7gn1Hv.js";import"./supabase-D6FkHI3a.js";const ue=(t,a)=>`https://source.boringavatars.com/beam/80/${String(t).replace(/[^a-zA-Z0-9]/g,"")||(a?String(a).substring(0,8):"user")}?colors=ff6b35,f7931e,ff8c42,1a0f0a,2d1810`,fe=({user:t,currentUserId:a,onUnfollow:s})=>{const[c,r]=n.useState(!1),m=async()=>{r(!0),await H(a,t.id)&&s(t.id),r(!1)},l=t.name||t.username||"Kullanıcı";return e.jsxs(S.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-10,transition:{duration:.2}},className:"glass-effect p-5 rounded-lg shadow-lg flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs(U,{to:`/profil/${t.id}`,className:"flex items-center gap-4 group w-full sm:w-auto",children:[e.jsxs(R,{className:"w-16 h-16 border-2 border-primary/40 group-hover:border-primary transition-colors",children:[e.jsx(G,{src:t.avatar_url||ue(l,t.id),alt:l}),e.jsx(X,{className:"text-xl",children:l.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground group-hover:text-primary transition-colors line-clamp-1",children:l}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.followers_count||0," Takipçi • ",t.following_count||0," Takip Edilen"]}),t.bio&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-1",children:t.bio})]})]}),a&&a!==t.id&&e.jsxs(h,{variant:"outline",size:"sm",onClick:m,disabled:c,className:"w-full sm:w-auto border-destructive text-destructive hover:bg-destructive/10 hover:text-destructive",children:[c?e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(de,{className:"w-4 h-4 mr-2"}),"Takipten Çık"]})]})},he=({category:t,listings:a,currentUserId:s,onUnfollowCategory:c,onToggleFavorite:r})=>{const[m,l]=n.useState(!1),p=Z(t.category_name)?.icon||_,i=async()=>{l(!0),await V(s,t.category_name)&&c(t.category_name),l(!1)};return e.jsxs(S.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-10,transition:{duration:.2}},className:"glass-effect p-5 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{className:"w-8 h-8 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:t.category_name})]}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:i,disabled:m,className:"text-destructive hover:bg-destructive/10 hover:text-destructive",children:[m?e.jsx(k,{className:"w-4 h-4 mr-1 animate-spin"}):e.jsx(me,{className:"w-4 h-4 mr-1"}),"Takipten Çık"]})]}),a&&a.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:a.map(d=>e.jsx(q,{listing:d,size:"small",onToggleFavorite:r,currentUser:s?{id:s}:null},d.id))}):e.jsx("p",{className:"text-muted-foreground text-sm",children:"Bu kategoride henüz yeni ilan bulunmuyor."})]})},pe=({isOpen:t,onClose:a,currentUserId:s,onCategoryFollowed:c})=>{const[r,m]=n.useState(""),[l,g]=n.useState(!1),p=async()=>{if(!r){N({title:"Hata",description:"Lütfen bir kategori seçin.",variant:"destructive"});return}g(!0);const d=await W(s,r);d&&!d.already_following?(c(r),N({title:"Başarılı",description:`"${r}" kategorisi takip edildi.`}),a()):d?.already_following&&N({title:"Bilgi",description:`"${r}" kategorisini zaten takip ediyorsunuz.`}),g(!1),m("")},i=(d,w="")=>{let u=[];return d.forEach(y=>{const x=w?`${w} > ${y.name}`:y.name;u.push(e.jsx(ne,{value:x,children:x},x)),y.subcategories&&y.subcategories.length>0&&(u=u.concat(i(y.subcategories,x)))}),u};return e.jsx(J,{open:t,onOpenChange:a,children:e.jsxs(Q,{className:"sm:max-w-[425px] glass-effect",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Kategori Takip Et"}),e.jsx(te,{children:"Yeni ilanlardan haberdar olmak için bir kategori seçin ve takibe alın."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs(ae,{value:r,onValueChange:m,children:[e.jsx(ie,{className:"w-full",children:e.jsx(re,{placeholder:"Kategori Seçin"})}),e.jsx(le,{children:i(ce)})]})}),e.jsxs(oe,{children:[e.jsx(h,{variant:"outline",onClick:a,disabled:l,children:"İptal"}),e.jsxs(h,{onClick:p,disabled:l||!r,className:"btn-primary",children:[l?e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(z,{className:"w-4 h-4 mr-2"}),"Takip Et"]})]})]})})},Te=({onToggleFavorite:t})=>{const{userId:a}=P(),{currentUser:s}=$(),[c,r]=n.useState("users"),[m,l]=n.useState([]),[g,p]=n.useState([]),[i,d]=n.useState(null),[w,u]=n.useState(!0),[y,x]=n.useState(!0),[v,T]=n.useState(null),[I,C]=n.useState(!1),j=a||s?.id;n.useEffect(()=>{if(!j)return;(async()=>{u(!0),x(!0),T(null);try{if(a&&a!==s?.id){const E=await M(a);if(!E)throw new Error("Profil sahibi bulunamadı.");d(E)}else s&&d(s);const f=await Y(j);l(f),u(!1);const b=await F(j,3,s?.id);p(b),x(!1)}catch(f){console.error("Error in FollowingPage useEffect:",f),T("Takip edilenler yüklenirken bir sorun oluştu."),N({title:"Hata",description:f.message||"Veri yüklenemedi.",variant:"destructive"}),u(!1),x(!1)}})()},[j,s,a]);const A=o=>{l(f=>f.filter(b=>b.id!==o))},B=o=>{p(f=>f.filter(b=>b.category_name!==o))},D=async()=>{x(!0);const o=await F(j,3,s?.id);p(o),x(!1)},O=i?i.id===s?.id?"Takip Ettiklerim":`${i.name||"Kullanıcı"}'nın Takip Ettikleri`:"Takip Edilenler";return(w||y)&&!v?e.jsx("div",{className:"min-h-[calc(100vh-160px)] flex items-center justify-center bg-background",children:e.jsx(k,{className:"h-16 w-16 animate-spin text-primary"})}):v?e.jsxs("div",{className:"min-h-[calc(100vh-160px)] flex flex-col items-center justify-center text-center px-4 bg-background",children:[e.jsx(xe,{className:"w-20 h-20 text-destructive mb-6"}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:"Bir Sorun Oluştu"}),e.jsx("p",{className:"text-muted-foreground mb-8 max-w-md",children:v}),!s&&e.jsx(h,{asChild:!0,className:"btn-primary text-primary-foreground",children:e.jsx(U,{to:"/auth?action=login",children:"Giriş Yap"})})]}):e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-10 text-center",children:e.jsx("h1",{className:"text-4xl font-bold text-gradient mb-3",children:O})}),e.jsxs("div",{className:"mb-8 flex justify-center border-b border-border/50",children:[e.jsxs("button",{onClick:()=>r("users"),className:`py-3 px-6 font-medium transition-colors duration-200 flex items-center gap-2 ${c==="users"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx(K,{className:"w-5 h-5"})," Takip Edilen Kullanıcılar (",m.length,")"]}),e.jsxs("button",{onClick:()=>r("categories"),className:`py-3 px-6 font-medium transition-colors duration-200 flex items-center gap-2 ${c==="categories"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx(ge,{className:"w-5 h-5"})," Takip Edilen Kategoriler (",g.length,")"]})]}),c==="users"&&e.jsx(e.Fragment,{children:m.length===0?e.jsxs("div",{className:"text-center py-12 glass-effect rounded-xl",children:[e.jsx(K,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:i&&i.id===s?.id?"Henüz Kimseyi Takip Etmiyorsun":"Bu Kullanıcı Henüz Kimseyi Takip Etmiyor"}),e.jsx("p",{className:"text-muted-foreground",children:"İlgi çekici profilleri takip etmeye başla!"}),e.jsx(h,{asChild:!0,className:"mt-6 btn-primary text-primary-foreground",children:e.jsx(U,{to:"/",children:"Keşfet"})})]}):e.jsx("div",{className:"space-y-4",children:e.jsx(L,{children:m.map(o=>e.jsx(fe,{user:o,currentUserId:s?.id,onUnfollow:A},o.id))})})}),c==="categories"&&e.jsxs(e.Fragment,{children:[i&&i.id===s?.id&&e.jsx("div",{className:"mb-6 text-right",children:e.jsxs(h,{onClick:()=>C(!0),className:"btn-primary",children:[e.jsx(z,{className:"w-4 h-4 mr-2"})," Yeni Kategori Takip Et"]})}),g.length===0?e.jsxs("div",{className:"text-center py-12 glass-effect rounded-xl",children:[e.jsx(_,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:i&&i.id===s?.id?"Henüz Kategori Takip Etmiyorsun":"Bu Kullanıcı Henüz Kategori Takip Etmiyor"}),e.jsx("p",{className:"text-muted-foreground",children:"İlgini çeken kategorileri takip ederek yeni ilanlardan haberdar ol."}),i&&i.id===s?.id&&e.jsx(h,{onClick:()=>C(!0),className:"mt-6 btn-primary text-primary-foreground",children:"Kategori Takip Et"})]}):e.jsx("div",{className:"space-y-6",children:e.jsx(L,{children:g.map(o=>e.jsx(he,{category:{category_name:o.category_name},listings:o.listings,currentUserId:s?.id,onUnfollowCategory:B,onToggleFavorite:t},o.category_name))})})]}),e.jsx(pe,{isOpen:I,onClose:()=>C(!1),currentUserId:s?.id,onCategoryFollowed:D})]})};export{Te as default};
