import{j as e}from"./query-tMv1bFhv.js";import{r as n,L as U,d as O}from"./router-Bq68dJ36.js";import{B as h,t as N,d as P}from"./auth-Dm-7ngQy.js";import{A as $,j as M,k as G,u as V,aE as W,L as Y,aF as J,D as R,b as X,c as Z,d as q,e as Q,S as ee,F as se,G as ae,H as te,aG as ie,J as re,aH as le,aI as oe,aA as ne,aJ as ce,aK as F}from"./listings-BkJHjkUV.js";import{m as S,L as k,aI as de,i as _,ac as me,b4 as A,aH as ge,ah as K,b5 as ue,A as L}from"./ui-YP8xOIYG.js";import"./vendor-Bs7gn1Hv.js";import"./images-C3EucWOq.js";import"./supabase-D6FkHI3a.js";const xe=(a,t)=>`https://source.boringavatars.com/beam/80/${String(a).replace(/[^a-zA-Z0-9]/g,"")||(t?String(t).substring(0,8):"user")}?colors=ff6b35,f7931e,ff8c42,1a0f0a,2d1810`,fe=({user:a,currentUserId:t,onUnfollow:s})=>{const[c,r]=n.useState(!1),m=async()=>{r(!0),await V(t,a.id)&&s(a.id),r(!1)},l=a.name||a.username||"Kullanıcı";return e.jsxs(S.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-10,transition:{duration:.2}},className:"glass-effect p-5 rounded-lg shadow-lg flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs(U,{to:`/profil/${a.id}`,className:"flex items-center gap-4 group w-full sm:w-auto",children:[e.jsxs($,{className:"w-16 h-16 border-2 border-primary/40 group-hover:border-primary transition-colors",children:[e.jsx(M,{src:a.avatar_url||xe(l,a.id),alt:l}),e.jsx(G,{className:"text-xl",children:l.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground group-hover:text-primary transition-colors line-clamp-1",children:l}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.followers_count||0," Takipçi • ",a.following_count||0," Takip Edilen"]}),a.bio&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-1",children:a.bio})]})]}),t&&t!==a.id&&e.jsxs(h,{variant:"outline",size:"sm",onClick:m,disabled:c,className:"w-full sm:w-auto border-destructive text-destructive hover:bg-destructive/10 hover:text-destructive",children:[c?e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(de,{className:"w-4 h-4 mr-2"}),"Takipten Çık"]})]})},he=({category:a,listings:t,currentUserId:s,onUnfollowCategory:c,onToggleFavorite:r})=>{const[m,l]=n.useState(!1),p=W(a.category_name)?.icon||_,i=async()=>{l(!0),await J(s,a.category_name)&&c(a.category_name),l(!1)};return e.jsxs(S.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-10,transition:{duration:.2}},className:"glass-effect p-5 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{className:"w-8 h-8 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:a.category_name})]}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:i,disabled:m,className:"text-destructive hover:bg-destructive/10 hover:text-destructive",children:[m?e.jsx(k,{className:"w-4 h-4 mr-1 animate-spin"}):e.jsx(me,{className:"w-4 h-4 mr-1"}),"Takipten Çık"]})]}),t&&t.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:t.map(d=>e.jsx(Y,{listing:d,size:"small",onToggleFavorite:r,currentUser:s?{id:s}:null},d.id))}):e.jsx("p",{className:"text-muted-foreground text-sm",children:"Bu kategoride henüz yeni ilan bulunmuyor."})]})},pe=({isOpen:a,onClose:t,currentUserId:s,onCategoryFollowed:c})=>{const[r,m]=n.useState(""),[l,u]=n.useState(!1),p=async()=>{if(!r){N({title:"Hata",description:"Lütfen bir kategori seçin.",variant:"destructive"});return}u(!0);const d=await le(s,r);d&&!d.already_following?(c(r),N({title:"Başarılı",description:`"${r}" kategorisi takip edildi.`}),t()):d?.already_following&&N({title:"Bilgi",description:`"${r}" kategorisini zaten takip ediyorsunuz.`}),u(!1),m("")},i=(d,w="")=>{let x=[];return d.forEach(y=>{const g=w?`${w} > ${y.name}`:y.name;x.push(e.jsx(re,{value:g,children:g},g)),y.subcategories&&y.subcategories.length>0&&(x=x.concat(i(y.subcategories,g)))}),x};return e.jsx(R,{open:a,onOpenChange:t,children:e.jsxs(X,{className:"sm:max-w-[425px] glass-effect",children:[e.jsxs(Z,{children:[e.jsx(q,{children:"Kategori Takip Et"}),e.jsx(Q,{children:"Yeni ilanlardan haberdar olmak için bir kategori seçin ve takibe alın."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs(ee,{value:r,onValueChange:m,children:[e.jsx(se,{className:"w-full",children:e.jsx(ae,{placeholder:"Kategori Seçin"})}),e.jsx(te,{children:i(oe)})]})}),e.jsxs(ie,{children:[e.jsx(h,{variant:"outline",onClick:t,disabled:l,children:"İptal"}),e.jsxs(h,{onClick:p,disabled:l||!r,className:"btn-primary",children:[l?e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(A,{className:"w-4 h-4 mr-2"}),"Takip Et"]})]})]})})},Se=({onToggleFavorite:a})=>{const{userId:t}=O(),{currentUser:s}=P(),[c,r]=n.useState("users"),[m,l]=n.useState([]),[u,p]=n.useState([]),[i,d]=n.useState(null),[w,x]=n.useState(!0),[y,g]=n.useState(!0),[v,T]=n.useState(null),[I,C]=n.useState(!1),j=t||s?.id;n.useEffect(()=>{if(!j)return;(async()=>{x(!0),g(!0),T(null);try{if(t&&t!==s?.id){const E=await ne(t);if(!E)throw new Error("Profil sahibi bulunamadı.");d(E)}else s&&d(s);const f=await ce(j);l(f),x(!1);const b=await F(j,3,s?.id);p(b),g(!1)}catch(f){console.error("Error in FollowingPage useEffect:",f),T("Takip edilenler yüklenirken bir sorun oluştu."),N({title:"Hata",description:f.message||"Veri yüklenemedi.",variant:"destructive"}),x(!1),g(!1)}})()},[j,s,t]);const z=o=>{l(f=>f.filter(b=>b.id!==o))},B=o=>{p(f=>f.filter(b=>b.category_name!==o))},D=async()=>{g(!0);const o=await F(j,3,s?.id);p(o),g(!1)},H=i?i.id===s?.id?"Takip Ettiklerim":`${i.name||"Kullanıcı"}'nın Takip Ettikleri`:"Takip Edilenler";return(w||y)&&!v?e.jsx("div",{className:"min-h-[calc(100vh-160px)] flex items-center justify-center bg-background",children:e.jsx(k,{className:"h-16 w-16 animate-spin text-primary"})}):v?e.jsxs("div",{className:"min-h-[calc(100vh-160px)] flex flex-col items-center justify-center text-center px-4 bg-background",children:[e.jsx(ge,{className:"w-20 h-20 text-destructive mb-6"}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:"Bir Sorun Oluştu"}),e.jsx("p",{className:"text-muted-foreground mb-8 max-w-md",children:v}),!s&&e.jsx(h,{asChild:!0,className:"btn-primary text-primary-foreground",children:e.jsx(U,{to:"/auth?action=login",children:"Giriş Yap"})})]}):e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-10 text-center",children:e.jsx("h1",{className:"text-4xl font-bold text-gradient mb-3",children:H})}),e.jsxs("div",{className:"mb-8 flex justify-center border-b border-border/50",children:[e.jsxs("button",{onClick:()=>r("users"),className:`py-3 px-6 font-medium transition-colors duration-200 flex items-center gap-2 ${c==="users"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx(K,{className:"w-5 h-5"})," Takip Edilen Kullanıcılar (",m.length,")"]}),e.jsxs("button",{onClick:()=>r("categories"),className:`py-3 px-6 font-medium transition-colors duration-200 flex items-center gap-2 ${c==="categories"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx(ue,{className:"w-5 h-5"})," Takip Edilen Kategoriler (",u.length,")"]})]}),c==="users"&&e.jsx(e.Fragment,{children:m.length===0?e.jsxs("div",{className:"text-center py-12 glass-effect rounded-xl",children:[e.jsx(K,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:i&&i.id===s?.id?"Henüz Kimseyi Takip Etmiyorsun":"Bu Kullanıcı Henüz Kimseyi Takip Etmiyor"}),e.jsx("p",{className:"text-muted-foreground",children:"İlgi çekici profilleri takip etmeye başla!"}),e.jsx(h,{asChild:!0,className:"mt-6 btn-primary text-primary-foreground",children:e.jsx(U,{to:"/",children:"Keşfet"})})]}):e.jsx("div",{className:"space-y-4",children:e.jsx(L,{children:m.map(o=>e.jsx(fe,{user:o,currentUserId:s?.id,onUnfollow:z},o.id))})})}),c==="categories"&&e.jsxs(e.Fragment,{children:[i&&i.id===s?.id&&e.jsx("div",{className:"mb-6 text-right",children:e.jsxs(h,{onClick:()=>C(!0),className:"btn-primary",children:[e.jsx(A,{className:"w-4 h-4 mr-2"})," Yeni Kategori Takip Et"]})}),u.length===0?e.jsxs("div",{className:"text-center py-12 glass-effect rounded-xl",children:[e.jsx(_,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:i&&i.id===s?.id?"Henüz Kategori Takip Etmiyorsun":"Bu Kullanıcı Henüz Kategori Takip Etmiyor"}),e.jsx("p",{className:"text-muted-foreground",children:"İlgini çeken kategorileri takip ederek yeni ilanlardan haberdar ol."}),i&&i.id===s?.id&&e.jsx(h,{onClick:()=>C(!0),className:"mt-6 btn-primary text-primary-foreground",children:"Kategori Takip Et"})]}):e.jsx("div",{className:"space-y-6",children:e.jsx(L,{children:u.map(o=>e.jsx(he,{category:{category_name:o.category_name},listings:o.listings,currentUserId:s?.id,onUnfollowCategory:B,onToggleFavorite:a},o.category_name))})})]}),e.jsx(pe,{isOpen:I,onClose:()=>C(!1),currentUserId:s?.id,onCategoryFollowed:D})]})};export{Se as default};
