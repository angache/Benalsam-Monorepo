import{j as e,u as V,a as W}from"./query-tMv1bFhv.js";import{r as d,d as J,u as Z,a as A,R as X,L as w,O as I}from"./router-Bq68dJ36.js";import{s as T,d as ee,B as f,t as ae}from"./auth-Dm-7ngQy.js";import{D as se,a as re,b as te,c as le,d as ie,e as ne,f as oe,g as ce,i as de,u as me,h as xe,A as E,j as q,k as L,L as ue,B as fe}from"./listings-BkJHjkUV.js";import{a as b}from"./images-C3EucWOq.js";import{an as P,o as he,S as B,aC as pe,P as ge,aD as ye,aE as be,aF as je,m as _,f as Ne,aG as ve,aH as we,aI as ke,aJ as Pe,l as _e,ah as D,b as Ce,I as ze,U as Se,ae as Te,aK as De,k as Ae,Q as Ee,a4 as qe,C as Le}from"./ui-YP8xOIYG.js";const F=d.createContext(),Ge=({children:s})=>{const[l,m]=d.useState(()=>localStorage.getItem("benalsam_theme")||"dark");d.useEffect(()=>{localStorage.setItem("benalsam_theme",l),document.documentElement.setAttribute("data-theme",l)},[l]);const r=()=>{m(a=>a==="light"?"dark":"light")};return e.jsx(F.Provider,{value:{theme:l,toggleTheme:r},children:s})},Be={profile_completeness:{title:"Profil Doluluğu",icon:e.jsx(be,{className:"w-5 h-5 text-blue-500"}),description:"Profilinize isim, biyografi ve avatar ekleyerek puan kazanın.",maxPoints:20},email_verification:{title:"E-posta Doğrulaması",icon:e.jsx(ye,{className:"w-5 h-5 text-green-500"}),description:"E-posta adresinizi doğrulayarak güvenliğinizi ve puanınızı artırın.",maxPoints:20},listings:{title:"Aktif İlanlar",icon:e.jsx(ge,{className:"w-5 h-5 text-orange-500"}),description:"Yayınladığınız her aktif ilan size puan kazandırır (Maks. 20 puan).",maxPoints:20},completed_trades:{title:"Başarılı Takaslar",icon:e.jsx(pe,{className:"w-5 h-5 text-purple-500"}),description:"Tamamladığınız her başarılı takas, güvenilirliğinizi kanıtlar.",maxPoints:20},reviews:{title:"Kullanıcı Yorumları",icon:e.jsx(B,{className:"w-5 h-5 text-yellow-500"}),description:"Aldığınız olumlu yorumlar puanınızı önemli ölçüde etkiler.",maxPoints:20}},Fe=({profile:s,children:l})=>{const m=s?.trust_score_breakdown||{},r=s?.trust_score||0,a=n=>{const t=m[n];return typeof t=="number"?t:typeof t=="object"&&t!==null&&"score"in t?t.score:0};return e.jsxs(se,{children:[e.jsx(re,{asChild:!0,children:l}),e.jsxs(te,{className:"sm:max-w-[480px] bg-card/90 backdrop-blur-lg border-slate-700",children:[e.jsxs(le,{children:[e.jsxs(ie,{className:"text-2xl font-bold text-gradient flex items-center gap-2",children:[e.jsx(P,{className:"w-6 h-6"}),"Güven Puanı Detayları"]}),e.jsx(ne,{children:"Güven puanınız, platformdaki diğer kullanıcılara ne kadar güvenilir olduğunuzu gösterir. Puanınızı artırmak için aşağıdaki adımları tamamlayabilirsiniz."})]}),e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Toplam Puanınız"}),e.jsxs("div",{className:"relative w-32 h-32 mx-auto",children:[e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 36 36",children:[e.jsx("path",{className:"text-slate-700",d:`M18 2.0845
                    a 15.9155 15.9155 0 0 1 0 31.831
                    a 15.9155 15.9155 0 0 1 0 -31.831`,fill:"none",stroke:"currentColor",strokeWidth:"3"}),e.jsx("path",{className:"text-primary",strokeDasharray:`${r}, 100`,d:`M18 2.0845
                    a 15.9155 15.9155 0 0 1 0 31.831
                    a 15.9155 15.9155 0 0 1 0 -31.831`,fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",transform:"rotate(90 18 18)"})]}),e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e.jsx("span",{className:"text-4xl font-bold text-white",children:r}),e.jsx("span",{className:"text-lg text-muted-foreground",children:"/100"})]})]})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(Be).map(([n,t])=>{const x=a(n),o=t.maxPoints>0&&x>=t.maxPoints;return e.jsx("div",{className:"p-3 rounded-lg bg-slate-800/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:b("flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center",o?"bg-green-500/20":"bg-slate-700"),children:o?e.jsx(he,{className:"w-5 h-5 text-green-400"}):t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("h4",{className:"font-semibold text-white",children:t.title}),e.jsxs("span",{className:b("font-bold",o?"text-green-400":"text-primary"),children:[x,t.maxPoints>0&&` / ${t.maxPoints}`]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description})]})]})},n)})})]})]})]})},$e=(s,l)=>{const m=V({queries:[{queryKey:["profile",s],queryFn:async()=>{if(!s)throw new Error("User ID is required");const{data:x,error:o}=await T.from("profiles").select("*").eq("id",s).single();if(o)throw o;return x},enabled:!!s,staleTime:3e5,gcTime:6e5,retry:2,retryDelay:1e3},{queryKey:["user-listings",s],queryFn:async()=>{if(!s)throw new Error("User ID is required");const{data:x,error:o}=await T.from("listings").select("*, user:profiles!user_id(id, name, avatar_url, rating)").eq("user_id",s).order("created_at",{ascending:!1});if(o)throw o;return x||[]},enabled:!!s,staleTime:12e4,gcTime:3e5,retry:2,retryDelay:1e3},{queryKey:["user-reviews",s],queryFn:async()=>{if(!s)throw new Error("User ID is required");return await oe(s)},enabled:!!s,staleTime:18e4,gcTime:48e4,retry:2,retryDelay:1e3},{queryKey:["follow-status",l,s],queryFn:async()=>!l||!s||l===s?!1:await ce(l,s),enabled:!!(l&&s&&l!==s),staleTime:6e4,gcTime:18e4,retry:1,retryDelay:500}]}),[r,a,n,t]=m;return{profile:r.data,listings:a.data||[],reviews:n.data||[],isFollowing:t.data||!1,isLoading:r.isLoading||a.isLoading||n.isLoading,isError:r.isError||a.isError||n.isError,error:r.error||a.error||n.error,refetch:()=>{r.refetch(),a.refetch(),n.refetch(),t.refetch()}}},$=(s,l)=>`https://source.boringavatars.com/beam/120/${(s?String(s).replace(/[^a-zA-Z0-9]/g,""):"")||(l?String(l).substring(0,8):"user")}?colors=ff6b35,f7931e,ff8c42,1a0f0a,2d1810`,K=X.memo(({reviews:s,currentUserId:l,onOpenLeaveReviewModal:m,profileData:r})=>!s||s.length===0?e.jsxs("div",{className:"text-center py-12 glass-effect rounded-xl",children:[e.jsx(P,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Henüz Yorum Yok"}),e.jsx("p",{className:"text-muted-foreground",children:"Bu kullanıcı hakkında henüz bir değerlendirme yapılmamış."})]}):e.jsx("div",{className:"space-y-6",children:s.map(a=>e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"glass-effect p-5 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(w,{to:`/profil/${a.reviewer.id}`,children:e.jsxs(E,{className:"w-12 h-12 border-2 border-primary/50",children:[e.jsx(q,{src:a.reviewer.avatar_url||$(a.reviewer.name,a.reviewer.id),alt:a.reviewer.name}),e.jsx(L,{children:a.reviewer.name?.charAt(0).toUpperCase()})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx(w,{to:`/profil/${a.reviewer.id}`,children:e.jsx("span",{className:"font-semibold text-foreground hover:text-primary",children:a.reviewer.name})}),e.jsx("div",{className:"flex items-center",children:[...Array(5)].map((n,t)=>e.jsx(B,{className:b("w-4 h-4",t<a.rating?"text-yellow-400 fill-yellow-400":"text-muted-foreground/50")},t))})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:[new Date(a.created_at).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric"}),a.offers&&a.offers.listings&&e.jsxs(e.Fragment,{children:[' - "',e.jsx(w,{to:`/ilan/${a.offers.listings.id}`,className:"text-primary hover:underline",children:a.offers.listings.title}),'" ilanı için']})]}),e.jsx("p",{className:"text-sm text-foreground/90 whitespace-pre-wrap",children:a.comment||"Kullanıcı yorum bırakmadı."})]})]}),l&&a.offer_id&&a.reviewer_id!==l&&a.reviewee_id===l&&e.jsx("div",{className:"mt-3 text-right",children:e.jsx(f,{variant:"link",size:"sm",className:"text-primary",onClick:()=>{const n={id:a.offer_id,offering_user_id:a.reviewer_id,profiles:a.reviewer,listings:{id:a.offers.listings.id,title:a.offers.listings.title,profiles:{id:a.reviewee_id,name:r?.name}}};m(n)},children:"Cevap Ver (Değerlendir)"})})]},a.id))}));K.displayName="ProfileReviews";const Ke=({onOpenLeaveReviewModal:s,openAuthModal:l,onToggleFavorite:m})=>{const{userId:r}=J(),a=Z();A();const{theme:n}=d.useContext(F),{currentUser:t}=ee(),x=W(),[o,C]=d.useState("ilanlar"),[j,z]=d.useState(!1),h=t&&t.id===r,{profile:i,listings:N,reviews:S,isFollowing:p,isLoading:M,isError:R,error:U,refetch:O}=$e(r,t?.id),g=d.useMemo(()=>i?.name||i?.username||"İsimsiz Kullanıcı",[i]),Q=d.useMemo(()=>g.charAt(0).toUpperCase(),[g]),Y=d.useCallback(c=>{if(!c)return"Konum belirtilmemiş";const{province:u,district:k,neighborhood:v}=c;return[u,k,v].filter(Boolean).join(" / ")||"Konum belirtilmemiş"},[]),y=d.useCallback(({icon:c,label:u,value:k,onClick:v})=>e.jsxs("div",{className:b("glass-effect p-4 rounded-lg flex flex-col items-center justify-center text-center",v&&"cursor-pointer hover:bg-primary/10 transition-colors"),onClick:v,children:[c,e.jsx("span",{className:"text-2xl font-bold mt-1",children:k}),e.jsx("span",{className:"text-xs text-muted-foreground",children:u})]}),[]);d.useEffect(()=>{r&&t&&t.id!==r&&(sessionStorage.getItem(`viewed_profile_${r}`)||(de(r),sessionStorage.setItem(`viewed_profile_${r}`,"true")))},[r,t]);const H=d.useCallback(()=>{a("/ayarlar")},[a]),G=d.useCallback(async()=>{if(!t){l("login");return}if(!(h||j||!i)){z(!0);try{let c;p?c=await me(t.id,i.id):c=await xe(t.id,i.id),c&&(x.invalidateQueries({queryKey:["follow-status",t.id,i.id]}),x.setQueryData(["profile",i.id],u=>u&&{...u,followers_count:p?Math.max(0,(u.followers_count||0)-1):(u.followers_count||0)+1}))}catch(c){console.error("Follow toggle error:",c)}finally{z(!1)}}},[t,h,j,i,p,l,x]);return M?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Profil yükleniyor..."})]})}):R?e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-center p-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-destructive mb-4",children:"Profil Yüklenemedi"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:U?.message||"Profil bilgileri yüklenirken bir hata oluştu."}),e.jsxs("div",{className:"space-x-4",children:[e.jsxs(f,{onClick:()=>O(),className:"btn-primary",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Tekrar Dene"]}),e.jsx(f,{onClick:()=>a("/"),variant:"outline",children:"Ana Sayfaya Dön"})]})]}):i?e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"relative bg-card/80 backdrop-blur-md shadow-xl rounded-2xl overflow-hidden p-6 md:p-8 mb-8",children:[e.jsx("div",{className:"absolute inset-x-0 top-0 h-32 bg-gradient-to-br from-primary/70 to-secondary/70 opacity-50 -z-10 transform -skew-y-3"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-6 relative z-10",children:[e.jsxs(E,{className:"w-32 h-32 md:w-40 md:h-40 border-4 border-background shadow-lg",children:[e.jsx(q,{src:i.avatar_url||$(g,i.id),alt:g}),e.jsx(L,{className:"text-4xl bg-muted",children:Q})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gradient mb-1",children:g}),i.username&&i.name&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",i.username]}),e.jsxs("p",{className:"text-muted-foreground flex items-center justify-center md:justify-start mt-2",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2 text-primary"}),Y(i)]}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed max-w-prose mt-2",children:i.bio||(h?"Henüz bir biyografi eklemediniz.":"Kullanıcının biyografisi bulunmuyor.")})]}),h?e.jsxs(f,{onClick:H,className:"btn-secondary w-full md:w-auto mt-4 md:mt-0 self-center md:self-start",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"})," Profili ve Ayarları Düzenle"]}):t&&e.jsxs(f,{onClick:G,disabled:j,className:b("w-full md:w-auto mt-4 md:mt-0 self-center md:self-start transition-all",p?"btn-secondary-amazon":"btn-primary"),children:[j?e.jsx(we,{className:"w-4 h-4 mr-2 animate-ping"}):p?e.jsx(ke,{className:"w-4 h-4 mr-2"}):e.jsx(Pe,{className:"w-4 h-4 mr-2"}),p?"Takipten Çık":"Takip Et"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 mt-8 pt-6 border-t border-border/50",children:[e.jsx(y,{icon:e.jsx(_e,{className:"w-6 h-6 text-primary"}),label:"İlan Sayısı",value:N.length}),e.jsx(y,{icon:e.jsx(D,{className:"w-6 h-6 text-purple-500"}),label:"Takipçi",value:i.followers_count||0,onClick:()=>{ae({title:"🚧 Bu özellik henüz uygulanmadı—ama merak etme! Bir sonraki istekte talep edebilirsin! 🚀"})}}),e.jsx(y,{icon:e.jsx(D,{className:"w-6 h-6 text-teal-500"}),label:"Takip Edilen",value:i.following_count||0,onClick:()=>a(`/takip-edilenler/${i.id}`)}),e.jsx(Fe,{profile:i,children:e.jsx(y,{icon:e.jsx(P,{className:"w-6 h-6 text-yellow-400"}),label:"Güven Puanı",value:i.trust_score||0})}),e.jsx(y,{icon:e.jsx(Ce,{className:"w-6 h-6 text-blue-500"}),label:"Profil Görüntülenme",value:i.profile_views||0})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex border-b border-border/50",children:[e.jsxs("button",{onClick:()=>C("ilanlar"),className:`py-3 px-6 font-medium transition-colors duration-200 ${o==="ilanlar"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"}`,children:["İlanlar (",N.length,")"]}),e.jsxs("button",{onClick:()=>C("yorumlar"),className:`py-3 px-6 font-medium transition-colors duration-200 ${o==="yorumlar"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"}`,children:["Yorumlar (",S.length,")"]})]})}),o==="ilanlar"&&(N.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:N.map(c=>e.jsx(ue,{listing:c,onToggleFavorite:m,currentUser:t},c.id))}):e.jsxs("div",{className:"text-center py-12 glass-effect rounded-xl",children:[e.jsx(ze,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Henüz İlan Yok"}),e.jsx("p",{className:"text-muted-foreground",children:h?"İlk ilanınızı oluşturarak başlayın!":"Bu kullanıcının henüz yayınlanmış bir ilanı bulunmuyor."}),h&&e.jsx(f,{onClick:()=>a("/ilan-olustur"),className:"mt-6 btn-primary",children:"İlan Oluştur"})]})),o==="yorumlar"&&e.jsx(K,{reviews:S,currentUserId:t?.id,onOpenLeaveReviewModal:s,profileData:i})]}):e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-center p-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-destructive mb-4",children:"Profil Bulunamadı"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Aradığınız kullanıcı profili mevcut değil veya bir hata oluştu."}),e.jsx(f,{onClick:()=>a("/"),className:"btn-primary",children:"Ana Sayfaya Dön"})]})},Ve=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"})),Me=()=>{const s=A(),l=[{path:"/ayarlar",icon:Se,label:"Profil Ayarları",exact:!0},{path:"/ayarlar/hesap",icon:Te,label:"Hesap Güvenliği"},{path:"/ayarlar/bildirimler",icon:De,label:"Bildirim Ayarları"},{path:"/ayarlar/iletisim",icon:Ae,label:"İletişim Tercihleri"},{path:"/ayarlar/platform",icon:Ee,label:"Platform Ayarları"},{path:"/ayarlar/premium",icon:qe,label:"Premium Üyelik",badge:"Yeni",badgeColor:"bg-gradient-to-r from-yellow-400 to-orange-500"}],m=(r,a=!1)=>a?s.pathname===r:s.pathname.startsWith(r);return e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gradient mb-2",children:"Ayarlar"}),e.jsx("p",{className:"text-muted-foreground",children:"Hesap ve platform tercihlerinizi yönetin"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx("nav",{className:"space-y-2",children:l.map(r=>{const a=r.icon,n=m(r.path,r.exact);return e.jsx(w,{to:r.path,children:e.jsx(f,{variant:n?"default":"ghost",className:`w-full justify-start text-left h-auto p-3 ${n?"bg-primary text-primary-foreground shadow-md":"hover:bg-muted/50 text-muted-foreground hover:text-foreground"}`,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:r.label})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.badge&&e.jsx(fe,{className:`text-xs px-2 py-0.5 text-white ${r.badgeColor||"bg-primary"}`,children:r.badge}),e.jsx(Le,{className:"w-3 h-3 opacity-50"})]})]})})},r.path)})})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx("div",{className:"glass-effect rounded-2xl p-6 min-h-[600px]",children:e.jsx(I,{})})})]})]})},We=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"}));export{Ve as P,We as S,F as T,Ge as a};
