import{j as e}from"./query-tMv1bFhv.js";import{r as n,R as I,u as U,d as Ge,L as G}from"./router-Bq68dJ36.js";import{u as se,h as Ye,b as T,g as ae,s as Y,t as c,B as p,e as W}from"./auth-CRgK8rPx.js";import{p as ie,R as Ue,T as He,P as Ke,W as Ve,q as qe,C as We,r as Xe,t as Je,u as Qe,v as re,O as Ze,S as et,w as tt,x as st,y as at,z as it,A as $,f as B,g as M,E as rt,B as nt,F as Q,G as V,H as lt,J as dt,K as ot,M as ct,N as mt,Q as ut,U as xt,V as gt,i as pt,X as ft,Y as ne,Z as ht,_ as vt,$ as bt}from"./listings-BLmNnY3e.js";import{a7 as jt,P as L,I as Z,D as yt,k as X,af as ee,ag as te,Y as C,aN as Nt,a4 as kt,m as F,A as wt,aO as _t,j as le,an as de,a2 as At,aP as St,o as Dt,ac as Ot}from"./ui-DwxUvrnm.js";import{c as q}from"./profile-Dy5Fyuz5.js";var oe="AlertDialog",[Tt,as]=qe(oe,[ie]),D=ie(),ce=a=>{const{__scopeAlertDialog:s,...r}=a,l=D(s);return e.jsx(Ue,{...l,...r,modal:!0})};ce.displayName=oe;var Ct="AlertDialogTrigger",me=n.forwardRef((a,s)=>{const{__scopeAlertDialog:r,...l}=a,u=D(r);return e.jsx(He,{...u,...l,ref:s})});me.displayName=Ct;var It="AlertDialogPortal",ue=a=>{const{__scopeAlertDialog:s,...r}=a,l=D(s);return e.jsx(Ke,{...l,...r})};ue.displayName=It;var Et="AlertDialogOverlay",xe=n.forwardRef((a,s)=>{const{__scopeAlertDialog:r,...l}=a,u=D(r);return e.jsx(Ze,{...u,...l,ref:s})});xe.displayName=Et;var R="AlertDialogContent",[zt,Pt]=Tt(R),Rt=Ye("AlertDialogContent"),ge=n.forwardRef((a,s)=>{const{__scopeAlertDialog:r,children:l,...u}=a,f=D(r),g=n.useRef(null),j=se(s,g),b=n.useRef(null);return e.jsx(Ve,{contentName:R,titleName:pe,docsSlug:"alert-dialog",children:e.jsx(zt,{scope:r,cancelRef:b,children:e.jsxs(We,{role:"alertdialog",...f,...u,ref:j,onOpenAutoFocus:Xe(u.onOpenAutoFocus,h=>{h.preventDefault(),b.current?.focus({preventScroll:!0})}),onPointerDownOutside:h=>h.preventDefault(),onInteractOutside:h=>h.preventDefault(),children:[e.jsx(Rt,{children:l}),e.jsx(Bt,{contentRef:g})]})})})});ge.displayName=R;var pe="AlertDialogTitle",fe=n.forwardRef((a,s)=>{const{__scopeAlertDialog:r,...l}=a,u=D(r);return e.jsx(Je,{...u,...l,ref:s})});fe.displayName=pe;var he="AlertDialogDescription",ve=n.forwardRef((a,s)=>{const{__scopeAlertDialog:r,...l}=a,u=D(r);return e.jsx(Qe,{...u,...l,ref:s})});ve.displayName=he;var $t="AlertDialogAction",be=n.forwardRef((a,s)=>{const{__scopeAlertDialog:r,...l}=a,u=D(r);return e.jsx(re,{...u,...l,ref:s})});be.displayName=$t;var je="AlertDialogCancel",ye=n.forwardRef((a,s)=>{const{__scopeAlertDialog:r,...l}=a,{cancelRef:u}=Pt(je,r),f=D(r),g=se(s,u);return e.jsx(re,{...f,...l,ref:g})});ye.displayName=je;var Bt=({contentRef:a})=>{const s=`\`${R}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${R}\` by passing a \`${he}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${R}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return n.useEffect(()=>{document.getElementById(a.current?.getAttribute("aria-describedby"))||console.warn(s)},[s,a]),null},Mt=ce,Lt=me,Ft=ue,Ne=xe,ke=ge,we=be,_e=ye,Ae=fe,Se=ve;const Gt=Mt,Yt=Lt,Ut=Ft,De=I.forwardRef(({className:a,...s},r)=>e.jsx(Ne,{className:T("fixed inset-0 z-50 bg-black/60 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:r}));De.displayName=Ne.displayName;const Oe=I.forwardRef(({className:a,...s},r)=>e.jsxs(Ut,{children:[e.jsx(De,{}),e.jsx(ke,{ref:r,className:T("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] rounded-lg md:w-full","glass-effect",a),...s})]}));Oe.displayName=ke.displayName;const Te=({className:a,...s})=>e.jsx("div",{className:T("flex flex-col space-y-2 text-center sm:text-left",a),...s});Te.displayName="AlertDialogHeader";const Ce=({className:a,...s})=>e.jsx("div",{className:T("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s});Ce.displayName="AlertDialogFooter";const Ie=I.forwardRef(({className:a,...s},r)=>e.jsx(Ae,{ref:r,className:T("text-lg font-semibold text-foreground",a),...s}));Ie.displayName=Ae.displayName;const Ee=I.forwardRef(({className:a,...s},r)=>e.jsx(Se,{ref:r,className:T("text-sm text-muted-foreground",a),...s}));Ee.displayName=Se.displayName;const ze=I.forwardRef(({className:a,...s},r)=>e.jsx(we,{ref:r,className:T(ae(),a),...s}));ze.displayName=we.displayName;const Pe=I.forwardRef(({className:a,...s},r)=>e.jsx(_e,{ref:r,className:T(ae({variant:"outline"}),"mt-2 sm:mt-0",a),...s}));Pe.displayName=_e.displayName;const Ht=async a=>{if(!a)return[];try{const{data:s,error:r}=await Y.from("inventory_items").select("*").eq("user_id",a).order("created_at",{ascending:!1});return r?(console.error("Error in fetchInventoryItems:",r),r.message.toLowerCase().includes("failed to fetch")?c({title:"Ağ Hatası",description:"Envanter yüklenemedi. İnternet bağlantınızı kontrol edin.",variant:"destructive"}):c({title:"Envanter Yüklenemedi",description:"Envanteriniz yüklenirken bir sorun oluştu.",variant:"destructive"}),[]):s||[]}catch(s){return console.error("Error in fetchInventoryItems:",s),c({title:"Beklenmedik Envanter Hatası",description:"Envanter yüklenirken beklenmedik bir sorun oluştu.",variant:"destructive"}),[]}},is=async(a,s)=>{try{const{error:r}=await Y.from("inventory_items").delete().eq("id",a).eq("user_id",s);return r?(c({title:"Envanter Silinemedi",description:r.message,variant:"destructive"}),!1):!0}catch(r){return console.error("Unexpected error in deleteInventoryItem:",r),c({title:"Beklenmedik Envanter Silme Hatası",description:"Envanter silinirken beklenmedik bir sorun oluştu.",variant:"destructive"}),!1}},Kt=I.memo(({listing:a,inventoryItems:s,userPlan:r,currentUser:l,onSubmit:u,isSubmitting:f,onOpenPremiumModal:g})=>{const j=U(),[b,h]=n.useState(""),[y,S]=n.useState(""),[_,O]=n.useState(""),[A,i]=n.useState(!1),[t,d]=n.useState(""),[m,N]=n.useState([]),[x,v]=n.useState({}),k=async()=>{if(!a||!l)return;if(!await Q(l.id,"ai_suggestions")){V("ai_suggestion",0,0),g();return}const w=await lt(a.title,a.description,a.budget);d(w),O(w),i(!0)},E=async o=>{const w=Array.from(o.target.files);if(w.length===0)return;if(!await Q(l.id,"file_attachments")){V("file_attachment",0,0),g();return}const K=5*1024*1024,Le=["image/jpeg","image/png","application/pdf","text/plain"],Fe=w.filter(P=>P.size>K?(c({title:"Dosya Çok Büyük",description:`${P.name} dosyası 5MB'dan büyük.`,variant:"destructive"}),!1):Le.includes(P.type)?!0:(c({title:"Desteklenmeyen Dosya",description:`${P.name} dosya tipi desteklenmiyor.`,variant:"destructive"}),!1));N(P=>[...P,...Fe])},H=o=>{N(w=>w.filter((Me,K)=>K!==o))},Re=()=>{const o={};return y!==""&&(isNaN(parseFloat(y))||parseFloat(y)<0)?o.offeredPrice="Geçerli bir teklif fiyatı girin (0 veya daha büyük).":y===""&&!b&&(o.offeredPrice="Lütfen bir ürün seçin veya bir nakit teklifi yapın."),_.trim()||(o.message="Lütfen bir teklif mesajı yazın."),v(o),Object.keys(o).length===0},$e=async o=>{if(o.preventDefault(),f||!Re())return;const w={listingId:a.id,offeredItemId:b||null,offeredPrice:y?parseFloat(y):null,message:_,aiSuggestion:A?t:null,attachments:m};u(w)},z=s.find(o=>o.id===b),J=r?.plan_slug!=="basic",Be=s.length===0;return e.jsxs("form",{onSubmit:$e,className:"space-y-6 p-6 glass-effect rounded-2xl",children:[Be&&e.jsx("div",{className:"p-4 rounded-lg bg-blue-500/10 border border-blue-500/20 text-blue-300",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(jt,{className:"w-5 h-5 mt-0.5 flex-shrink-0 text-blue-400"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-300",children:"Daha Güçlü Teklifler İçin İpucu!"}),e.jsx("p",{className:"text-sm mt-1 text-blue-300/80",children:"Envanteriniz şu an boş. Teklifinize envanterinizden bir ürün eklemek, karşı tarafın teklifinizi daha ciddiye almasını sağlayabilir. Dilerseniz sadece nakit teklif de yapabilirsiniz."}),e.jsx(p,{type:"button",variant:"link",className:"p-0 h-auto mt-2 text-blue-400 hover:text-blue-300",onClick:()=>j("/envanterim/yeni"),children:"Envanterime Ürün Ekle →"})]})]})}),e.jsxs("fieldset",{disabled:f,children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground mb-1.5",children:[e.jsx(L,{className:"w-4 h-4 inline mr-2 text-primary"})," Teklif Edilecek Envanter Ürünü (Opsiyonel)"]}),e.jsxs(et,{value:b,onValueChange:h,children:[e.jsx(tt,{className:`w-full bg-input border-border text-foreground ${x.selectedItemId?"border-destructive":""}`,children:e.jsx(st,{placeholder:"Envanterinizden bir ürün seçin..."})}),e.jsx(at,{className:"dropdown-content max-h-60",children:s.map(o=>e.jsx(it,{value:o.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs($,{className:"w-6 h-6",children:[e.jsx(B,{src:o.main_image_url||o.image_url,alt:o.name}),e.jsx(M,{children:e.jsx(Z,{className:"w-3 h-3"})})]}),e.jsx("span",{children:o.name})]})},o.id))})]}),x.selectedItemId&&e.jsx("p",{className:"text-destructive text-xs mt-1",children:x.selectedItemId}),z&&e.jsxs("div",{className:"mt-2 p-3 bg-muted/30 rounded-md border border-border/50 flex items-center gap-3",children:[e.jsxs($,{className:"w-12 h-12",children:[e.jsx(B,{src:z.main_image_url||z.image_url,alt:z.name}),e.jsx(M,{children:e.jsx(Z,{className:"w-6 h-6"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:z.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:z.category})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground mb-1.5",children:[e.jsx(yt,{className:"w-4 h-4 inline mr-2 text-primary"})," Ek Nakit Teklifi (₺) (Opsiyonel)"]}),e.jsx("input",{type:"number",value:y,onChange:o=>S(o.target.value),placeholder:"0",min:"0",className:`w-full px-4 py-2.5 bg-input border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none input-glow ${x.offeredPrice?"border-destructive":"border-border"}`}),x.offeredPrice&&e.jsx("p",{className:"text-destructive text-xs mt-1",children:x.offeredPrice})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground",children:[e.jsx(X,{className:"w-4 h-4 inline mr-2 text-primary"})," Teklif Mesajınız *"]}),J&&e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:k,className:"text-xs",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"}),"AI Öneri"]})]}),t&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-xs font-medium text-blue-700 dark:text-blue-300",children:"AI Önerisi"})]}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200 mb-2",children:t}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rt,{id:"use-ai",checked:A,onCheckedChange:i}),e.jsx("label",{htmlFor:"use-ai",className:"text-xs text-blue-700 dark:text-blue-300",children:"Bu AI önerisini kullan"})]})]}),e.jsx("textarea",{value:_,onChange:o=>O(o.target.value),placeholder:"Teklifiniz hakkında ek detaylar, takas koşulları vb.",rows:4,className:`w-full px-4 py-2.5 bg-input border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none input-glow resize-none ${x.message?"border-destructive":"border-border"}`}),x.message&&e.jsx("p",{className:"text-destructive text-xs mt-1",children:x.message})]}),J&&r?.plan_slug==="corporate"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground mb-1.5",children:[e.jsx(te,{className:"w-4 h-4 inline mr-2 text-primary"})," Dosya Ekleri (Opsiyonel)",e.jsx(nt,{variant:"secondary",className:"ml-2 text-xs",children:"Kurumsal"})]}),e.jsx("input",{type:"file",multiple:!0,accept:".jpg,.jpeg,.png,.pdf,.txt",onChange:E,className:"w-full px-4 py-2.5 bg-input border border-border rounded-lg text-foreground file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"JPG, PNG, PDF, TXT dosyaları desteklenir. Maksimum 5MB."}),m.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:m.map((o,w)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/50 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm truncate",children:o.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",(o.size/1024).toFixed(1)," KB)"]})]}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>H(w),className:"text-destructive hover:text-destructive",children:"Kaldır"})]},w))})]})]}),e.jsxs("div",{className:"flex gap-4 pt-3",children:[e.jsx(p,{type:"button",variant:"outline",className:"flex-1 border-muted-foreground/50 text-muted-foreground hover:bg-muted-foreground/10",children:"İptal"}),e.jsxs(p,{type:"submit",disabled:f,className:"flex-1 btn-primary text-primary-foreground",children:[f?e.jsx(C,{className:"w-5 h-5 animate-spin mr-2"}):e.jsx(Nt,{className:"w-4 h-4 mr-2"}),f?"Gönderiliyor...":"Teklifi Gönder"]})]})]})}),Vt=({userPlan:a})=>{if(!a)return null;const s=a.plan_slug!=="basic";return e.jsx(dt,{className:"mb-6 border-primary/20",children:e.jsx(ot,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s?e.jsx(kt,{className:"w-5 h-5 text-yellow-500"}):e.jsx(L,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"font-semibold",children:a.plan_name})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.limits?.offers_per_month===-1?"Sınırsız teklif":`${a.limits?.offers_per_month||10} teklif/ay`})]})})})},qt=()=>{const{listingId:a}=Ge(),s=U(),{user:r}=W(),[l,u]=n.useState(null),[f,g]=n.useState([]),[j,b]=n.useState(!1),[h,y]=n.useState(!1),[S,_]=n.useState(!1),[O,A]=n.useState(!1),[i,t]=n.useState(null);n.useEffect(()=>{if(!r){b(!1);return}(async()=>{b(!0);const{data:v,error:k}=await Y.from("listings").select("id, title, description, budget, user_id, status").eq("id",a).single();if(k||!v){c({title:"İlan Bulunamadı",description:"Teklif yapılacak ilan bulunamadı.",variant:"destructive"}),s(-1);return}if(v.user_id===r.id){c({title:"Kendi İlanınız",description:"Kendi ilanınıza teklif yapamazsınız.",variant:"info"}),s(-1);return}if(v.status==="in_transaction"||v.status==="sold"){c({title:"Teklif Yapılamaz",description:"Bu ilan için bir teklif kabul edilmiş veya ilan satılmış.",variant:"info"}),s(`/ilan/${a}`);return}u(v);const E=await gt(r.id);t(E),b(!1)})()},[r?.id,a]),n.useEffect(()=>{if(!r)return;(async()=>{y(!0);try{const v=await Ht(r.id);console.log("Inventory data loaded:",v),g(v||[])}catch(v){console.error("Inventory yükleme hatası:",v),g([])}finally{y(!1)}})()},[r?.id]);const d=n.useCallback(async x=>{if(!r){c({title:"Giriş Gerekli",description:"Teklif yapmak için giriş yapmalısınız.",variant:"destructive"});return}if(!await ct(r.id)){V("offer",0,i?.limits?.offers_per_month||10),A(!0);return}_(!0);try{const{data:k,error:E}=await Y.from("offers").insert([{listing_id:l.id,offering_user_id:r.id,offered_item_id:x.selectedItemId,message:x.message,status:"pending"}]).select().single();if(E){c({title:"Teklif Gönderilemedi",description:E.message,variant:"destructive"});return}if(x.attachments&&x.attachments.length>0)for(const H of x.attachments)await mt(k.id,H);await ut(r.id,"offer"),c({title:"Başarılı!",description:"Teklifiniz başarıyla gönderildi."}),s(`/ilan/${l.id}`)}catch(k){console.error("Teklif gönderme hatası:",k),c({title:"Hata",description:"Teklif gönderilirken bir sorun oluştu.",variant:"destructive"})}finally{_(!1)}},[r?.id,i,l]),m=n.useMemo(()=>j||h||!l,[j,h,l]),N=n.useMemo(()=>j?"İlan yükleniyor...":h?"Envanter yükleniyor...":"Yükleniyor...",[j,h]);return m?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"w-12 h-12 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:N})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-2xl mx-auto px-4 py-12",children:[e.jsxs("div",{className:"flex items-center mb-8",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>s(-1),className:"mr-4 text-muted-foreground hover:text-foreground",disabled:S,children:e.jsx(wt,{className:"w-6 h-6"})}),e.jsxs("h1",{className:"text-2xl font-bold text-gradient truncate",children:["Teklif Yap: ",l.title]})]}),e.jsx(Vt,{userPlan:i}),e.jsx(Kt,{listing:l,inventoryItems:f,userPlan:i,currentUser:r,onSubmit:d,isSubmitting:S,onOpenPremiumModal:()=>A(!0)})]}),e.jsx(xt,{isOpen:O,onOpenChange:A,feature:"offer"})]})},rs=Object.freeze(Object.defineProperty({__proto__:null,default:qt},Symbol.toStringTag,{value:"Module"})),Wt=()=>{const a=U(),{currentUser:s}=W(),[r,l]=n.useState([]),[u,f]=n.useState(!0),[g,j]=n.useState(null),[b,h]=n.useState({});n.useEffect(()=>{if(!s)return;(async()=>{f(!0);const t=await ft(s.id);l(t||[]);const d={};if(t)for(const m of t)m.status==="accepted"?d[m.id]=await q(s.id,m.id):d[m.id]=!1;h(d),f(!1)})()},[s]);const y=i=>{switch(i?.toLowerCase()){case"pending":return"text-yellow-400 border-yellow-400/50 bg-yellow-400/10";case"accepted":return"text-green-400 border-green-400/50 bg-green-400/10";case"rejected":return"text-red-400 border-red-400/50 bg-red-400/10";case"cancelled":return"text-slate-400 border-slate-400/50 bg-slate-400/10";default:return"text-slate-500 border-slate-500/50 bg-slate-500/10"}},S=async i=>{j(i),await ht(i,s.id)?(l(d=>d.filter(m=>m.id!==i)),c({title:"Teklif Silindi",description:"Teklifiniz başarıyla silindi."})):c({title:"Hata",description:"Teklif silinirken bir sorun oluştu.",variant:"destructive"}),j(null)},_=async i=>{if(!s||!i.listings||!i.listings.profiles){c({title:"Hata",description:"Sohbet başlatılamadı, kullanıcı veya ilan bilgileri eksik.",variant:"destructive"});return}let t=i.conversation_id;t||(t=await ne(s.id,i.listings.user_id,i.id,i.listings.id)),t?(l(d=>d.map(m=>m.id===i.id?{...m,conversation_id:t}:m)),a(`/mesajlar/${t}`)):c({title:"Sohbet Başlatılamadı",description:"Lütfen tekrar deneyin.",variant:"destructive"})},O=i=>{i&&i.id?c({title:"Ürün Detayı (Yakında)",description:`${i.name} adlı ürünün detay sayfası yakında eklenecektir. Şimdilik envanter sayfanızdan kontrol edebilirsiniz.`,action:e.jsx(p,{onClick:()=>a("/envanterim"),variant:"outline",size:"sm",children:"Envantere Git"})}):c({title:"Ürün Bilgisi Yok",description:"Bu teklifte bir ürün belirtilmemiş.",variant:"info"})},A=i=>{a(`/degerlendirme/${i.id}`)};return u?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(C,{className:"w-16 h-16 animate-spin text-primary"})}):e.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.5},className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-10",children:e.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-gradient flex items-center",children:[e.jsx(_t,{className:"w-8 h-8 mr-3 text-primary"})," Gönderdiğim Teklifler"]})}),r.length>0?e.jsx("div",{className:"space-y-6",children:r.map(i=>e.jsxs(F.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},className:"glass-effect rounded-xl p-5 shadow-lg hover:shadow-primary/20 transition-shadow",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-3",children:[e.jsxs("div",{className:"mb-2 sm:mb-0",children:[i.listings?e.jsx(G,{to:`/ilan/${i.listings.id}`,className:"hover:underline",children:e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-1",children:i.listings.title||"İlan Başlığı Yok"})}):e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-1",children:"İlan Bilgisi Yok"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Teklif Tarihi: ",pt(i.created_at)]})]}),e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full border ${y(i.status)}`,children:i.status?.charAt(0).toUpperCase()+i.status?.slice(1)||"Bilinmiyor"})]}),e.jsx("div",{className:"border-t border-border/50 my-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Teklif Edilen Ürünüm:"}),i.inventory_items?e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-background/30 rounded-md",children:[e.jsxs($,{className:"w-12 h-12 rounded-md",children:[e.jsx(B,{src:i.inventory_items.main_image_url||i.inventory_items.image_url,alt:i.inventory_items.name}),e.jsx(M,{className:"rounded-md bg-muted",children:e.jsx(L,{className:"w-6 h-6 text-muted-foreground"})})]}),e.jsxs("div",{children:[e.jsxs(p,{variant:"link",className:"p-0 h-auto font-medium text-foreground hover:text-primary text-left",onClick:()=>O(i.inventory_items),children:[i.inventory_items.name||"Ürün Adı Yok"," ",e.jsx(le,{className:"w-3 h-3 ml-1 opacity-70"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i.inventory_items.category||"Kategori Yok"})]})]}):e.jsx("p",{className:"text-sm text-foreground italic",children:"Bu teklifte ürün belirtilmemiş."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Ek Nakit Teklifim:"}),e.jsx("p",{className:"text-lg font-semibold text-primary",children:i.offered_price?`${i.offered_price.toLocaleString()} ₺`:"Yok"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Mesajım:"}),e.jsx("p",{className:"text-sm text-foreground bg-background/20 p-3 rounded-md whitespace-pre-wrap",children:i.message||"Ek mesaj yok."})]}),e.jsx("div",{className:"border-t border-border/50 my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i.listings?.profiles&&e.jsxs(e.Fragment,{children:[e.jsxs($,{className:"w-8 h-8",children:[e.jsx(B,{src:i.listings.profiles.avatar_url,alt:i.listings.profiles.name}),e.jsx(M,{children:i.listings.profiles.name?.charAt(0)||"İ"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["İlan Sahibi:",e.jsx(G,{to:`/profil/${i.listings.profiles.id}`,className:"text-primary hover:underline",children:i.listings.profiles.name||"Bilinmiyor"})]})]}),!i.listings?.profiles&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"İlan Sahibi: Bilinmiyor"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap justify-end",children:[i.id&&e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>_(i),className:"border-blue-500/50 text-blue-400 hover:bg-blue-500/10",children:[e.jsx(X,{className:"w-3.5 h-3.5 mr-1.5"}),i.conversation_id?"Sohbete Git":"Mesaj Gönder"]}),i.status==="accepted"&&b[i.id]&&e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>A(i),className:"border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/10",children:[e.jsx(de,{className:"w-3.5 h-3.5 mr-1.5"})," Değerlendir"]}),(i.status==="pending"||i.status==="cancelled")&&e.jsxs(Gt,{children:[e.jsx(Yt,{asChild:!0,children:e.jsxs(p,{variant:"outline",size:"sm",disabled:g===i.id,className:"border-destructive/50 text-destructive hover:bg-destructive/10",children:[g===i.id?e.jsx(C,{className:"w-3.5 h-3.5 mr-1.5 animate-spin"}):e.jsx(At,{className:"w-3.5 h-3.5 mr-1.5"}),"Teklifi Geri Çek"]})}),e.jsxs(Oe,{children:[e.jsxs(Te,{children:[e.jsx(Ie,{children:"Teklifi Geri Çekmek İstediğinize Emin Misiniz?"}),e.jsx(Ee,{children:"Bu işlem geri alınamaz. Teklifiniz kalıcı olarak silinecektir."})]}),e.jsxs(Ce,{children:[e.jsx(Pe,{children:"İptal"}),e.jsx(ze,{onClick:()=>S(i.id),className:"bg-destructive hover:bg-destructive/90",children:"Evet, Geri Çek"})]})]})]})]})]})]},i.id))}):e.jsxs("div",{className:"text-center py-20 glass-effect rounded-2xl",children:[e.jsx(L,{className:"w-20 h-20 text-primary mx-auto mb-6"}),e.jsx("h2",{className:"text-2xl font-semibold text-foreground mb-3",children:"Henüz hiç teklif göndermemişsiniz."}),e.jsx("p",{className:"text-muted-foreground mb-8 max-w-md mx-auto",children:"Beğendiğiniz ilanlara teklif yaparak takas dünyasına adım atın!"}),e.jsx(p,{onClick:()=>a("/"),className:"btn-primary text-primary-foreground px-8 py-3 text-lg",children:"İlanları Keşfet"})]})]})},ns=Object.freeze(Object.defineProperty({__proto__:null,default:Wt},Symbol.toStringTag,{value:"Module"})),Xt=()=>{const a=U(),{currentUser:s}=W(),[r,l]=n.useState([]),[u,f]=n.useState(!0),[g,j]=n.useState(null),[b,h]=n.useState({});n.useEffect(()=>{if(!s)return;(async()=>{f(!0);const d=await vt(s.id);l(d||[]);const m={};if(d)for(const N of d)N.status==="accepted"?m[N.id]=await q(s.id,N.id):m[N.id]=!1;h(m),f(!1)})()},[s,a]);const y=t=>{switch(t?.toLowerCase()){case"pending":return"text-yellow-400 border-yellow-400/50 bg-yellow-400/10";case"accepted":return"text-green-400 border-green-400/50 bg-green-400/10";case"rejected":return"text-red-400 border-red-400/50 bg-red-400/10";case"cancelled":return"text-slate-400 border-slate-400/50 bg-slate-400/10";default:return"text-slate-500 border-slate-500/50 bg-slate-500/10"}},S=async(t,d,m,N)=>{j(t);const x=await bt(t,d,s.id,m,s.id);if(x){if(l(v=>v.map(k=>k.id===t?{...k,status:x.status,conversation_id:x.conversation_id}:k)),c({title:"Teklif Durumu Güncellendi",description:`Teklif ${d==="accepted"?"kabul edildi":"reddedildi"}.`}),d==="accepted"){const v=await q(s.id,t);h(k=>({...k,[t]:v}))}}else c({title:"Hata",description:"Teklif durumu güncellenirken bir sorun oluştu.",variant:"destructive"});j(null)},_=async t=>{if(!s||!t.profiles){c({title:"Hata",description:"Sohbet başlatılamadı, kullanıcı bilgileri eksik.",variant:"destructive"});return}let d=t.conversation_id;d||(d=await ne(s.id,t.offering_user_id,t.id,t.listing_id)),d?(l(m=>m.map(N=>N.id===t.id?{...N,conversation_id:d}:N)),a(`/mesajlar/${d}`)):c({title:"Sohbet Başlatılamadı",description:"Lütfen tekrar deneyin.",variant:"destructive"})},O=t=>{t&&t.id?c({title:"Ürün Detayı (Yakında)",description:`${t.name} adlı ürünün detay sayfası yakında eklenecektir.`}):c({title:"Ürün Bilgisi Yok",description:"Bu teklifte bir ürün belirtilmemiş.",variant:"info"})},A=t=>{a(`/degerlendirme/${t.id}`)},i=t=>t?new Date(t).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Bilinmiyor";return u?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(C,{className:"w-16 h-16 animate-spin text-primary"})}):e.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.5},className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-10",children:e.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-gradient flex items-center",children:[e.jsx(St,{className:"w-8 h-8 mr-3 text-primary"})," Aldığım Teklifler"]})}),r.length>0?e.jsx("div",{className:"space-y-6",children:r.map(t=>{const d=t.inventory_items;return e.jsxs(F.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},className:"glass-effect rounded-xl p-5 shadow-lg hover:shadow-primary/20 transition-shadow",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-3",children:[e.jsxs("div",{className:"mb-2 sm:mb-0",children:[t.listings?e.jsx(G,{to:`/ilan/${t.listings.id}`,className:"hover:underline",children:e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-1",children:t.listings.title||"İlan Başlığı Yok"})}):e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-1",children:"İlan Bilgisi Yok"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Teklif Tarihi: ",i(t.created_at)]})]}),e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full border ${y(t.status)}`,children:t.status?.charAt(0).toUpperCase()+t.status?.slice(1)||"Bilinmiyor"})]}),e.jsx("div",{className:"border-t border-border/50 my-4"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Teklif Edilen Ürün:"}),d&&d.id?e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-background/30 rounded-md",children:[e.jsxs($,{className:"w-12 h-12 rounded-md",children:[e.jsx(B,{src:d.main_image_url||d.image_url,alt:d.name}),e.jsx(M,{className:"rounded-md bg-muted",children:e.jsx(L,{className:"w-6 h-6 text-muted-foreground"})})]}),e.jsxs("div",{children:[e.jsxs(p,{variant:"link",className:"p-0 h-auto font-medium text-foreground hover:text-primary text-left",onClick:()=>O(d),children:[d.name||"Ürün Adı Yok"," ",e.jsx(le,{className:"w-3 h-3 ml-1 opacity-70"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d.category||"Kategori Yok"})]})]}):e.jsx("p",{className:"text-sm text-foreground italic",children:"Bu teklifte ürün belirtilmemiş."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Ek Nakit Teklifi:"}),e.jsx("p",{className:"text-lg font-semibold text-primary",children:t.offered_price?`${t.offered_price.toLocaleString()} ₺`:"Yok"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Teklif Verenin Mesajı:"}),e.jsx("p",{className:"text-sm text-foreground bg-background/20 p-3 rounded-md whitespace-pre-wrap",children:t.message||"Ek mesaj yok."})]}),e.jsx("div",{className:"border-t border-border/50 my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.profiles&&e.jsxs(e.Fragment,{children:[e.jsxs($,{className:"w-8 h-8",children:[e.jsx(B,{src:t.profiles.avatar_url,alt:t.profiles.name}),e.jsx(M,{children:t.profiles.name?.charAt(0)||"T"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Teklif Veren:",e.jsx(G,{to:`/profil/${t.profiles.id}`,className:"text-primary hover:underline",children:t.profiles.name||"Bilinmiyor"})]})]}),!t.profiles&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"Teklif Veren: Bilinmiyor"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap justify-end",children:[t.id&&e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>_(t),className:"border-blue-500/50 text-blue-400 hover:bg-blue-500/10",children:[e.jsx(X,{className:"w-3.5 h-3.5 mr-1.5"}),t.conversation_id?"Sohbete Git":"Mesaj Gönder"]}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>S(t.id,"accepted",t.offering_user_id,t.listing_id),disabled:g===t.id,className:"border-green-500/50 text-green-400 hover:bg-green-500/10",children:[g===t.id&&t.status!=="accepted"?e.jsx(C,{className:"w-3.5 h-3.5 mr-1.5 animate-spin"}):e.jsx(Dt,{className:"w-3.5 h-3.5 mr-1.5"}),"Kabul Et"]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>S(t.id,"rejected",t.offering_user_id,t.listing_id),disabled:g===t.id,className:"border-red-500/50 text-red-400 hover:bg-red-500/10",children:[g===t.id&&t.status!=="rejected"?e.jsx(C,{className:"w-3.5 h-3.5 mr-1.5 animate-spin"}):e.jsx(Ot,{className:"w-3.5 h-3.5 mr-1.5"}),"Reddet"]})]}),t.status==="accepted"&&b[t.id]&&e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>A(t),className:"border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/10",children:[e.jsx(de,{className:"w-3.5 h-3.5 mr-1.5"})," Değerlendir"]})]})]})]},t.id)})}):e.jsxs("div",{className:"text-center py-20 glass-effect rounded-2xl",children:[e.jsx(L,{className:"w-20 h-20 text-primary mx-auto mb-6"}),e.jsx("h2",{className:"text-2xl font-semibold text-foreground mb-3",children:"Henüz hiç teklif almamışsınız."}),e.jsx("p",{className:"text-muted-foreground mb-8 max-w-md mx-auto",children:"İlanlarınız ilgi gördükçe burada teklifleri görebileceksiniz."}),e.jsx(p,{onClick:()=>a("/"),className:"btn-primary text-primary-foreground px-8 py-3 text-lg",children:"Ana Sayfaya Dön"})]})]})},ls=Object.freeze(Object.defineProperty({__proto__:null,default:Xt},Symbol.toStringTag,{value:"Module"}));export{Gt as A,rs as M,ls as R,ns as S,Yt as a,Oe as b,Te as c,is as d,Ie as e,Ht as f,Ee as g,Ce as h,Pe as i,ze as j};
