import{j as n}from"./query-tMv1bFhv.js";import{r as c,R as C,u as G,a as Z}from"./router-Bq68dJ36.js";import{c as X,a as q}from"./images-C3EucWOq.js";import{m as P,a as Q,U as ee,M as te,K as O,E as U,b as T}from"./ui-YP8xOIYG.js";import{c as re}from"./supabase-D6FkHI3a.js";function V(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function K(...e){return t=>{let r=!1;const a=e.map(s=>{const o=V(s,t);return!r&&typeof o=="function"&&(r=!0),o});if(r)return()=>{for(let s=0;s<a.length;s++){const o=a[s];typeof o=="function"?o():V(e[s],null)}}}}function Ne(...e){return c.useCallback(K(...e),e)}function ae(e){const t=ne(e),r=c.forwardRef((a,s)=>{const{children:o,...u}=a,l=c.Children.toArray(o),p=l.find(oe);if(p){const i=p.props.children,m=l.map(f=>f===p?c.Children.count(i)>1?c.Children.only(null):c.isValidElement(i)?i.props.children:null:f);return n.jsx(t,{...u,ref:s,children:c.isValidElement(i)?c.cloneElement(i,void 0,m):null})}return n.jsx(t,{...u,ref:s,children:o})});return r.displayName=`${e}.Slot`,r}var se=ae("Slot");function ne(e){const t=c.forwardRef((r,a)=>{const{children:s,...o}=r;if(c.isValidElement(s)){const u=le(s),l=ie(o,s.props);return s.type!==c.Fragment&&(l.ref=a?K(a,u):u),c.cloneElement(s,l)}return c.Children.count(s)>1?c.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var M=Symbol("radix.slottable");function Ee(e){const t=({children:r})=>n.jsx(n.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=M,t}function oe(e){return c.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===M}function ie(e,t){const r={...t};for(const a in t){const s=e[a],o=t[a];/^on[A-Z]/.test(a)?s&&o?r[a]=(...l)=>{const p=o(...l);return s(...l),p}:s&&(r[a]=s):a==="style"?r[a]={...s,...o}:a==="className"&&(r[a]=[s,o].filter(Boolean).join(" "))}return{...e,...r}}function le(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}const R=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,L=X,ue=(e,t)=>r=>{var a;if(t?.variants==null)return L(e,r?.class,r?.className);const{variants:s,defaultVariants:o}=t,u=Object.keys(s).map(i=>{const m=r?.[i],f=o?.[i];if(m===null)return null;const b=R(m)||R(f);return s[i][b]}),l=r&&Object.entries(r).reduce((i,m)=>{let[f,b]=m;return b===void 0||(i[f]=b),i},{}),p=t==null||(a=t.compoundVariants)===null||a===void 0?void 0:a.reduce((i,m)=>{let{class:f,className:b,...x}=m;return Object.entries(x).every(j=>{let[g,v]=j;return Array.isArray(v)?v.includes({...o,...l}[g]):{...o,...l}[g]===v})?[...i,f,b]:i},[]);return L(e,u,p,r?.class,r?.className)},ce=1;let E=0;function de(){return E=(E+1)%Number.MAX_VALUE,E.toString()}const h={state:{toasts:[]},listeners:[],getState:()=>h.state,setState:e=>{typeof e=="function"?h.state=e(h.state):h.state={...h.state,...e},h.listeners.forEach(t=>t(h.state))},subscribe:e=>(h.listeners.push(e),()=>{h.listeners=h.listeners.filter(t=>t!==e)})},_=({...e})=>{const t=de(),r=s=>h.setState(o=>({...o,toasts:o.toasts.map(u=>u.id===t?{...u,...s}:u)})),a=()=>h.setState(s=>({...s,toasts:s.toasts.filter(o=>o.id!==t)}));return h.setState(s=>({...s,toasts:[{...e,id:t,dismiss:a},...s.toasts].slice(0,ce)})),{id:t,dismiss:a,update:r}};function Ce(){const[e,t]=c.useState(h.getState());return c.useEffect(()=>h.subscribe(a=>{t(a)}),[]),c.useEffect(()=>{const r=[];return e.toasts.forEach(a=>{if(a.duration===1/0)return;const s=setTimeout(()=>{a.dismiss()},a.duration||5e3);r.push(s)}),()=>{r.forEach(a=>clearTimeout(a))}},[e.toasts]),{toast:_,toasts:e.toasts}}const me=ue("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:'[data-theme="light"]_&_:(bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm border border-transparent) [data-theme="dark"]_&_:(bg-primary text-primary-foreground hover:bg-primary/90)',destructive:'[data-theme="light"]_&_:(bg-destructive text-destructive-foreground hover:bg-destructive/90 border border-transparent) [data-theme="dark"]_&_:(bg-destructive text-destructive-foreground hover:bg-destructive/90)',outline:'[data-theme="light"]_&_:(border border-input bg-background hover:bg-accent hover:text-accent-foreground shadow-sm) [data-theme="dark"]_&_:(border border-input bg-background hover:bg-accent hover:text-accent-foreground)',secondary:'[data-theme="light"]_&_:(bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm border border-transparent) [data-theme="dark"]_&_:(bg-secondary text-secondary-foreground hover:bg-secondary/80)',ghost:'[data-theme="light"]_&_:(hover:bg-accent hover:text-accent-foreground) [data-theme="dark"]_&_:(hover:bg-accent hover:text-accent-foreground)',link:'[data-theme="light"]_&_:(text-secondary underline-offset-4 hover:underline hover:text-primary) [data-theme="dark"]_&_:(text-primary underline-offset-4 hover:underline)'},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),I=C.forwardRef(({className:e,variant:t,size:r,asChild:a=!1,...s},o)=>{const u=a?se:"button";return n.jsx(u,{className:q(me({variant:t,size:r,className:e})),ref:o,...s})});I.displayName="Button";const fe="https://dnwreckpeenhbdtapmxr.supabase.co",ge="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRud3JlY2twZWVuaGJkdGFwbXhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5OTgwNzAsImV4cCI6MjA2NTU3NDA3MH0.2lzsxTj4hoKTcZeoCGMsUC3Cmsm1pgcqXP-3j_GV_Ys",w=re(fe,ge,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"sb-dnwreckpeenhbdtapmxr-auth-token-web"}}),D=e=>{let t;const r=new Set,a=(i,m)=>{const f=typeof i=="function"?i(t):i;if(!Object.is(f,t)){const b=t;t=m??(typeof f!="object"||f===null)?f:Object.assign({},t,f),r.forEach(x=>x(t,b))}},s=()=>t,l={setState:a,getState:s,getInitialState:()=>p,subscribe:i=>(r.add(i),()=>r.delete(i))},p=t=e(a,s,l);return l},pe=e=>e?D(e):D,he=e=>e;function be(e,t=he){const r=C.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return C.useDebugValue(r),r}const B=e=>{const t=pe(e),r=a=>be(t,a);return Object.assign(r,t),r},xe=e=>e?B(e):B,$=xe((e,t)=>((async()=>{console.log("🔐 Auth Store: Auto-initializing..."),e({loading:!0});try{const{data:{session:a}}=await w.auth.getSession();if(console.log("🔐 Auth Store: Session check result:",{hasSession:!!a,userId:a?.user?.id}),a?.user){const s={id:a.user.id,email:a.user.email,name:a.user.user_metadata?.name||"Kullanıcı",avatar_url:a.user.user_metadata?.avatar_url,rating:null,total_ratings:0,rating_sum:0,created_at:a.user.created_at,updated_at:a.user.updated_at||a.user.created_at};e({user:s,currentUser:s,loading:!1,initialized:!0}),console.log("🔐 Auth Store: Basic user set, profile will be fetched by React Query when needed")}else console.log("🔐 Auth Store: No session found"),e({user:null,currentUser:null,loading:!1,initialized:!0});w.auth.onAuthStateChange(async(s,o)=>{s==="SIGNED_OUT"&&(console.log("🔐 Auth Store: User signed out"),e({user:null,currentUser:null}))})}catch(a){console.error("🔐 Auth Store: Initialize error:",a),e({user:null,currentUser:null,loading:!1,initialized:!0})}})(),{user:null,currentUser:null,loading:!1,initialized:!1,signIn:async(a,s)=>{e({loading:!0});try{const{data:o,error:u}=await w.auth.signInWithPassword({email:a,password:s});if(u)return e({loading:!1}),{error:u.message};if(o.user){const l={id:o.user.id,email:o.user.email,name:o.user.user_metadata?.name||"Kullanıcı",avatar_url:o.user.user_metadata?.avatar_url,rating:null,total_ratings:0,rating_sum:0,created_at:o.user.created_at,updated_at:o.user.updated_at||o.user.created_at};e({user:l,currentUser:l,loading:!1})}return{}}catch{return e({loading:!1}),{error:"Giriş yapılırken bir hata oluştu"}}},signUp:async(a,s,o)=>{e({loading:!0});try{const u=`https://source.boringavatars.com/beam/120/${o.replace(/\s+/g,"")||"benalsamUser"}?colors=ff6b35,f7931e,ff8c42,1a0f0a,2d1810`,{data:l,error:p}=await w.auth.signUp({email:a,password:s,options:{data:{name:o,avatar_url:u}}});if(p)return e({loading:!1}),{error:p.message};if(l.user){const{error:i}=await w.from("profiles").update({name:o,avatar_url:u,updated_at:new Date().toISOString()}).eq("id",l.user.id);i&&console.error("Error updating profile on signup:",i);const m={id:l.user.id,email:l.user.email,name:l.user.user_metadata?.name||o,avatar_url:l.user.user_metadata?.avatar_url||u,rating:null,total_ratings:0,rating_sum:0,created_at:l.user.created_at,updated_at:l.user.updated_at||l.user.created_at};e({user:m,currentUser:m,loading:!1})}return{}}catch{return e({loading:!1}),{error:"Kayıt olurken bir hata oluştu"}}},signOut:async()=>{e({loading:!0});try{await w.auth.signOut(),e({user:null,currentUser:null,loading:!1})}catch{e({loading:!1})}},initialize:async()=>{console.log("🔐 Auth Store: Manual initialize called (auto-initialization already running)")}})),ye=()=>{const e=G(),t=Z(),{signIn:r,signUp:a,currentUser:s}=$();c.useEffect(()=>{s&&e("/",{replace:!0})},[s,e]);const u=new URLSearchParams(t.search).get("action")==="register"?"register":"login",[l,p]=c.useState(u),[i,m]=c.useState({name:"",email:"",password:"",confirmPassword:""}),[f,b]=c.useState(!1),[x,j]=c.useState(!1),[g,v]=c.useState({}),[y,A]=c.useState(!1);c.useEffect(()=>{p(u),m({name:"",email:"",password:"",confirmPassword:""}),v({})},[u]);const k=(d,S)=>{m(N=>({...N,[d]:S})),g[d]&&v(N=>({...N,[d]:""}))},J=()=>{const d={};return l==="register"&&!i.name.trim()&&(d.name="İsim gerekli"),i.email.trim()?/\S+@\S+\.\S+/.test(i.email)||(d.email="Geçerli bir e-posta adresi girin"):d.email="E-posta gerekli",i.password?i.password.length<6&&(d.password="Şifre en az 6 karakter olmalı"):d.password="Şifre gerekli",l==="register"&&i.password!==i.confirmPassword&&(d.confirmPassword="Şifreler eşleşmiyor"),v(d),Object.keys(d).length===0},Y=async d=>{if(d.preventDefault(),!J()){_({title:"Hata!",description:"Lütfen tüm alanları doğru doldurun.",variant:"destructive"});return}if(A(!0),v({}),l==="register"){const S=await a(i.email,i.password,i.name);S.error?_({title:"Kayıt Başarısız",description:S.error,variant:"destructive"}):(_({title:"Başarılı!",description:"Hesabınız başarıyla oluşturuldu.",variant:"default"}),e("/"))}else{const S=await r(i.email,i.password);S.error?_({title:"Giriş Başarısız",description:S.error,variant:"destructive"}):(_({title:"Başarılı!",description:"Başarıyla giriş yaptınız.",variant:"default"}),e("/"))}A(!1),Object.keys(g).length||m({name:"",email:"",password:"",confirmPassword:""})},F=d=>{p(d),e(`/auth?action=${d}`,{replace:!0}),v({}),m({name:"",email:"",password:"",confirmPassword:""})},z=l==="login"?"Giriş Yap":"Kayıt Ol",H=l==="login"?"Hesabın yok mu?":"Zaten hesabın var mı?",W=l==="login"?"Kayıt Ol":"Giriş Yap";return n.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-background to-slate-900/30 p-4",children:[n.jsx("div",{className:"absolute top-4 left-4",children:n.jsxs(I,{variant:"ghost",onClick:()=>e("/"),className:"text-muted-foreground hover:text-foreground",children:[n.jsx(Q,{className:"w-5 h-5 mr-2"})," Ana Sayfa"]})}),n.jsxs(P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"w-full max-w-md glass-effect rounded-2xl p-8 shadow-2xl",children:[n.jsx("div",{className:"text-center mb-8",children:n.jsx("h1",{className:"text-3xl font-bold text-gradient",children:z})}),n.jsxs("form",{onSubmit:Y,className:"space-y-6",children:[l==="register"&&n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-foreground mb-2",children:[n.jsx(ee,{className:"w-4 h-4 inline mr-2 text-primary"})," İsim *"]}),n.jsx("input",{type:"text",value:i.name,onChange:d=>k("name",d.target.value),placeholder:"Adınız Soyadınız",disabled:y,className:`w-full px-4 py-3 bg-input border rounded-xl text-foreground placeholder-muted-foreground focus:outline-none input-glow ${g.name?"border-destructive":"border-border"}`}),g.name&&n.jsx("p",{className:"text-destructive text-sm mt-1",children:g.name})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-foreground mb-2",children:[n.jsx(te,{className:"w-4 h-4 inline mr-2 text-primary"})," E-posta *"]}),n.jsx("input",{type:"email",value:i.email,onChange:d=>k("email",d.target.value),placeholder:"ornek@mail.com",disabled:y,className:`w-full px-4 py-3 bg-input border rounded-xl text-foreground placeholder-muted-foreground focus:outline-none input-glow ${g.email?"border-destructive":"border-border"}`}),g.email&&n.jsx("p",{className:"text-destructive text-sm mt-1",children:g.email})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-foreground mb-2",children:[n.jsx(O,{className:"w-4 h-4 inline mr-2 text-primary"})," Şifre *"]}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:f?"text":"password",value:i.password,onChange:d=>k("password",d.target.value),placeholder:"••••••••",disabled:y,className:`w-full px-4 py-3 bg-input border rounded-xl text-foreground placeholder-muted-foreground focus:outline-none input-glow ${g.password?"border-destructive":"border-border"}`}),n.jsx("button",{type:"button",onClick:()=>b(!f),className:"absolute inset-y-0 right-0 px-3 flex items-center text-muted-foreground hover:text-foreground",disabled:y,children:f?n.jsx(U,{className:"w-5 h-5"}):n.jsx(T,{className:"w-5 h-5"})})]}),g.password&&n.jsx("p",{className:"text-destructive text-sm mt-1",children:g.password})]}),l==="register"&&n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-foreground mb-2",children:[n.jsx(O,{className:"w-4 h-4 inline mr-2 text-primary"})," Şifre Tekrar *"]}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:x?"text":"password",value:i.confirmPassword,onChange:d=>k("confirmPassword",d.target.value),placeholder:"••••••••",disabled:y,className:`w-full px-4 py-3 bg-input border rounded-xl text-foreground placeholder-muted-foreground focus:outline-none input-glow ${g.confirmPassword?"border-destructive":"border-border"}`}),n.jsx("button",{type:"button",onClick:()=>j(!x),className:"absolute inset-y-0 right-0 px-3 flex items-center text-muted-foreground hover:text-foreground",disabled:y,children:x?n.jsx(U,{className:"w-5 h-5"}):n.jsx(T,{className:"w-5 h-5"})})]}),g.confirmPassword&&n.jsx("p",{className:"text-destructive text-sm mt-1",children:g.confirmPassword})]}),n.jsx(I,{type:"submit",className:"w-full btn-primary text-primary-foreground font-semibold py-3 text-lg",disabled:y,children:y?n.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary-foreground"}):z})]}),n.jsx("div",{className:"mt-6 text-center",children:n.jsxs("p",{className:"text-sm text-muted-foreground",children:[H," ",n.jsx("button",{onClick:()=>{y||F(l==="login"?"register":"login")},className:"font-semibold text-primary hover:text-primary/80",disabled:y,children:W})]})})]})]})},Ie=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"})),ve=()=>{const e=G(),{setCurrentUser:t,setLoadingAuth:r}=$(),[a,s]=c.useState("Doğrulama işleniyor, lütfen bekleyin..."),[o,u]=c.useState("");return c.useEffect(()=>{const l=async()=>{r(!0),await new Promise(f=>setTimeout(f,500));const{data:{session:i},error:m}=await w.auth.getSession();if(m){console.error("Error getting session on callback:",m),u("Oturum alınırken bir hata oluştu. Lütfen tekrar deneyin."),s(""),r(!1),_({title:"Doğrulama Hatası",description:"Oturum bilgileri alınamadı.",variant:"destructive"}),e("/");return}if(i&&i.user){const{data:{user:f},error:b}=await w.auth.refreshSession(),x=f||i.user;if(b&&console.warn("Error refreshing session on callback, using existing session user data:",b),x.email_confirmed_at||x.phone_confirmed_at){s("E-posta adresiniz başarıyla doğrulandı! Yönlendiriliyorsunuz...");const{data:j,error:g}=await w.from("profiles").select("*").eq("id",x.id).single();g?(console.error("Error fetching profile after callback:",g),_({title:"Profil Yüklenemedi",description:"Profiliniz yüklenirken bir sorun oluştu.",variant:"destructive"})):j&&t(j),e("/")}else u("E-posta adresiniz henüz doğrulanmamış görünüyor. Lütfen e-postanızı kontrol edin veya birkaç dakika sonra tekrar deneyin."),s("")}else u("Doğrulama başarısız oldu. Geçerli bir oturum bulunamadı. Lütfen tekrar giriş yapmayı deneyin."),s(""),e("/?authError=true");r(!1)},p=window.location.hash;if(p.includes("access_token")||p.includes("error_description"))l();else{const i=setTimeout(()=>{s("Doğrulama bilgisi bulunamadı veya zaten işlendi. Ana sayfaya yönlendiriliyorsunuz..."),e("/")},2500);return()=>clearTimeout(i)}},[e,t,r]),n.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background text-foreground p-4 text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-primary mb-8"}),a&&n.jsx("p",{className:"text-xl font-semibold mb-4",children:a}),o&&n.jsx("p",{className:"text-xl text-destructive",children:o}),!a&&!o&&n.jsx("p",{className:"text-xl",children:"Yönlendiriliyorsunuz..."})]})},Ae=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{Ie as A,I as B,K as a,ue as b,ae as c,$ as d,me as e,Ee as f,Ce as g,Ae as h,w as s,_ as t,Ne as u};
