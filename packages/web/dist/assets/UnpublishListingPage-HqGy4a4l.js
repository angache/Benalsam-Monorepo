import{j as e}from"./query-tMv1bFhv.js";import{d as w,u as L,r as i}from"./router-Bq68dJ36.js";import{d as z,B as m,s as g,t as u}from"./auth-Dm-7ngQy.js";import{aM as p,S as C,F as D,G as B,H as R,J as E,aN as I}from"./listings-CDgdt6vp.js";import{L as v,m as K,a as P,p as q}from"./ui-YP8xOIYG.js";import"./vendor-Bs7gn1Hv.js";import"./images-C3EucWOq.js";import"./supabase-D6FkHI3a.js";const Y=()=>{const{listingId:r}=w(),n=L(),{currentUser:c}=z(),[x,j]=i.useState(null),[s,y]=i.useState(""),[d,b]=i.useState(""),[l,h]=i.useState(!1),[N,f]=i.useState(!0),S=[{value:"Sattım",label:"Ürünü sattım"},{value:"Vazgeçtim",label:"Satmaktan vazgeçtim"},{value:"Diğer",label:"Diğer"}];i.useEffect(()=>{if(!c||!r)return;(async()=>{f(!0);const{data:o,error:t}=await g.from("listings").select("*").eq("id",r).eq("user_id",c.id).single();if(t||!o){u({title:"İlan Bulunamadı",description:"Kaldırılacak ilan bulunamadı.",variant:"destructive"}),n(-1);return}j(o),f(!1)})()},[c,r,n]);const k=async()=>{const a=s==="Diğer"?d.trim():s;if(!a)return;const o=s==="Sattım"?"sold":"inactive";h(!0);try{const{error:t}=await g.from("listings").update({status:o,unpublish_reason:a,updated_at:new Date().toISOString()}).eq("id",r);if(t)throw t;u({title:"İlan Yayından Kaldırıldı",description:`İlanınız "${a}" nedeniyle yayından kaldırıldı.`}),n("/ilanlarim")}catch(t){console.error("Error unpublishing listing:",t),u({title:"Hata",description:"İlan kaldırılırken bir sorun oluştu.",variant:"destructive"})}finally{h(!1)}};return N?e.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[e.jsx(v,{className:"w-8 h-8 animate-spin text-primary mr-3"}),e.jsx("span",{children:"İlan bilgileri yükleniyor..."})]}):x?e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-lg mx-auto px-4 py-12",children:[e.jsxs("div",{className:"flex items-center mb-8",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>n(-1),className:"mr-4 text-muted-foreground hover:text-foreground",children:e.jsx(P,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{className:"w-7 h-7 mr-3 text-destructive"}),e.jsx("h1",{className:"text-2xl font-bold text-gradient",children:"İlanı Yayından Kaldır"})]})]}),e.jsxs("div",{className:"glass-effect rounded-2xl p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-foreground mb-2",children:["İlan: ",x.title]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"İlanınızı neden yayından kaldırdığınızı belirtin. Bu bilgi, deneyiminizi iyileştirmemize yardımcı olur."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"reason",className:"text-sm font-medium",children:"Neden"}),e.jsxs(C,{value:s,onValueChange:y,children:[e.jsx(D,{className:"bg-input border-border",children:e.jsx(B,{placeholder:"Bir neden seçin..."})}),e.jsx(R,{children:S.map(a=>e.jsx(E,{value:a.value,children:a.label},a.value))})]})]}),s==="Diğer"&&e.jsxs("div",{children:[e.jsx(p,{htmlFor:"other-reason",className:"text-sm font-medium",children:"Detay"}),e.jsx(I,{id:"other-reason",value:d,onChange:a=>b(a.target.value),className:"bg-input border-border",placeholder:"Lütfen nedeninizi belirtin..."})]})]}),e.jsxs("div",{className:"flex gap-4 pt-3",children:[e.jsx(m,{variant:"outline",onClick:()=>n(-1),disabled:l,className:"flex-1",children:"İptal"}),e.jsxs(m,{onClick:k,disabled:!s||s==="Diğer"&&!d.trim()||l,className:"flex-1 bg-destructive hover:bg-destructive/90",children:[l&&e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),l?"İşleniyor...":"Onayla ve Kaldır"]})]})]})]}):null};export{Y as default};
