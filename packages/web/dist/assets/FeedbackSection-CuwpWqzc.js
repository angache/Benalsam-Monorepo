import{j as e}from"./query-tMv1bFhv.js";import{r as a}from"./router-Bq68dJ36.js";import{e as F,B as v,t as i,s as u}from"./auth-CRgK8rPx.js";import{S as D,w as E,x as T,y as U,z as l,aA as C}from"./listings-BLmNnY3e.js";import{a3 as P,aN as N,k as _,bf as M,bg as A}from"./ui-DwxUvrnm.js";import"./vendor-Bs7gn1Hv.js";import"./supabase-D6FkHI3a.js";const Y=()=>{const{currentUser:n}=F(),[c,y]=a.useState("suggestion"),[o,h]=a.useState(""),[d,x]=a.useState(null),[f,p]=a.useState(""),[b,m]=a.useState(!1),w=t=>{const s=t.target.files[0];if(s){if(s.size>2*1024*1024){i({title:"Dosya Boyutu Büyük",description:"Ekran görüntüsü 2MB'den küçük olmalıdır.",variant:"destructive"});return}x(s);const r=new FileReader;r.onloadend=()=>p(r.result),r.readAsDataURL(s)}},S=async t=>{if(t.preventDefault(),!n||!o.trim()){i({title:"Eksik Bilgi",description:"Lütfen geri bildirim mesajınızı yazın.",variant:"destructive"});return}m(!0);let s=null;if(d){const B=d.name.split(".").pop(),j=`feedback_screenshots/${`feedback-${n.id}-${Date.now()}.${B}`}`,{error:k}=await u.storage.from("item_images").upload(j,d,{cacheControl:"3600",upsert:!0});if(k){i({title:"Ekran Görüntüsü Yükleme Hatası",description:k.message,variant:"destructive"}),m(!1);return}const{data:G}=u.storage.from("item_images").getPublicUrl(j);s=G.publicUrl}const r={user_id:n.id,feedback_type:c,message:o.trim(),screenshot_url:s},{error:g}=await u.from("user_feedback").insert([r]);m(!1),g?i({title:"Geri Bildirim Gönderilemedi",description:g.message,variant:"destructive"}):(i({title:"Geri Bildiriminiz Alındı!",description:"Değerli görüşleriniz için teşekkür ederiz."}),h(""),x(null),p(""))},z=()=>{switch(c){case"bug":return e.jsx(A,{className:"w-5 h-5 mr-2 text-destructive"});case"suggestion":return e.jsx(M,{className:"w-5 h-5 mr-2 text-yellow-500"});default:return e.jsx(_,{className:"w-5 h-5 mr-2 text-primary"})}};return e.jsxs("form",{onSubmit:S,className:"space-y-6 p-6 border border-border rounded-lg glass-effect",children:[e.jsxs("div",{className:"flex items-center",children:[z(),e.jsx("h3",{className:"text-lg font-medium",children:"Geri Bildirim Gönder"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Platformumuzla ilgili düşüncelerinizi, önerilerinizi veya karşılaştığınız sorunları bizimle paylaşın."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"feedbackType",className:"block text-sm font-medium mb-1",children:"Geri Bildirim Türü"}),e.jsxs(D,{value:c,onValueChange:y,children:[e.jsx(E,{id:"feedbackType",className:"w-full sm:w-1/2",children:e.jsx(T,{placeholder:"Geri bildirim türünü seçin"})}),e.jsxs(U,{className:"dropdown-content",children:[e.jsx(l,{value:"suggestion",children:"Öneri / Fikir"}),e.jsx(l,{value:"bug",children:"Hata Bildirimi"}),e.jsx(l,{value:"complaint",children:"Şikayet"}),e.jsx(l,{value:"other",children:"Diğer"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"message",className:"block text-sm font-medium mb-1",children:"Mesajınız"}),e.jsx(C,{id:"message",value:o,onChange:t=>h(t.target.value),placeholder:"Düşüncelerinizi buraya yazın...",required:!0,className:"min-h-[120px]"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"screenshot",className:"block text-sm font-medium mb-1",children:"Ekran Görüntüsü (İsteğe Bağlı)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{htmlFor:"screenshotUpload",className:"cursor-pointer",children:[e.jsx(v,{type:"button",variant:"outline",asChild:!0,children:e.jsxs("span",{children:[e.jsx(P,{className:"w-4 h-4 mr-2"})," Görüntü Seç"]})}),e.jsx("input",{type:"file",id:"screenshotUpload",accept:"image/*",onChange:w,className:"hidden"})]}),f&&e.jsx("div",{className:"w-20 h-20 border border-border rounded-md overflow-hidden",children:e.jsx("img-replace",{src:f,alt:"Ekran görüntüsü önizlemesi",className:"w-full h-full object-cover"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Max. 2MB. JPG, PNG, GIF formatları desteklenir."})]}),e.jsxs(v,{type:"submit",disabled:b,className:"btn-primary w-full sm:w-auto",children:[b?e.jsx(N,{className:"w-4 h-4 mr-2 animate-pulse"}):e.jsx(N,{className:"w-4 h-4 mr-2"}),"Geri Bildirimi Gönder"]})]})};export{Y as default};
