import{j as e}from"./query-tMv1bFhv.js";import{d as w,u as L,r as l}from"./router-Bq68dJ36.js";import{t as p,s as v,e as D,i as B,B as x}from"./auth-CRgK8rPx.js";import{az as y,S as T,w as z,x as A,y as E,z as C,aA as R}from"./listings-BLmNnY3e.js";import{m as _,A as G,p as I,aN as k}from"./ui-DwxUvrnm.js";import"./vendor-Bs7gn1Hv.js";import"./supabase-D6FkHI3a.js";const F=async s=>{const{reporter_id:i,listing_id:r,reason:n,details:m}=s;if(!i||!r||!n)return p({title:"Eksik Bilgi",description:"Şikayet oluşturmak için gerekli tüm alanlar doldurulmalıdır.",variant:"destructive"}),null;const{data:u,error:t}=await v.from("listing_reports").insert([{reporter_id:i,listing_id:r,reason:n,details:m}]).select().single();return t?(console.error("Error creating listing report:",t),p({title:"Şikayet Oluşturulamadı",description:t.message,variant:"destructive"}),null):(p({title:"Şikayet Gönderildi",description:"İlanla ilgili şikayetiniz alınmıştır. En kısa sürede incelenecektir.",variant:"default"}),u)},P=["Yasaklı ürün veya hizmet","Yanlış veya yanıltıcı kategori","Aldatıcı veya eksik bilgi","Spam veya alakasız içerik","Telif hakkı ihlali","Dolandırıcılık şüphesi","BenAlsam politikalarına aykırı","Diğer"],J=()=>{const{listingId:s}=w(),i=L(),{currentUser:r}=D(),{toast:n}=B(),[m,u]=l.useState(""),[t,b]=l.useState(""),[d,j]=l.useState(""),[o,f]=l.useState(!1),[N,h]=l.useState(!0);l.useEffect(()=>{if(!r||!s)return;(async()=>{h(!0);const{data:c,error:g}=await v.from("listings").select("title").eq("id",s).single();if(g||!c){n({title:"İlan Bulunamadı",description:"Şikayet edilecek ilan bulunamadı.",variant:"destructive"}),i(-1);return}u(c.title),h(!1)})()},[r,s,i]);const S=async a=>{if(a.preventDefault(),!t){n({title:"Şikayet Nedeni Seçilmedi",description:"Lütfen bir şikayet nedeni seçin.",variant:"destructive"});return}if(t==="Diğer"&&!d.trim()){n({title:"Detay Gerekli",description:"Lütfen 'Diğer' seçeneği için şikayet detayını belirtin.",variant:"destructive"});return}f(!0);const c={reporter_id:r.id,listing_id:s,reason:t,details:d.trim()},g=await F(c);f(!1),g&&i(`/ilan/${s}`)};return N?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-lg mx-auto px-4 py-12",children:[e.jsxs("div",{className:"flex items-center mb-8",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>i(-1),className:"mr-4 text-muted-foreground hover:text-foreground",disabled:o,children:e.jsx(G,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"w-7 h-7 mr-3 text-destructive"}),e.jsxs("h1",{className:"text-2xl font-bold text-gradient truncate",children:["İlanı Şikayet Et: ",m]})]})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6 p-6 glass-effect rounded-2xl",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bu ilanın BenAlsam politikalarına aykırı olduğunu düşünüyorsanız, lütfen aşağıdaki formu doldurun."}),e.jsxs("fieldset",{disabled:o,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"reason",className:"font-medium",children:"Şikayet Nedeni *"}),e.jsxs(T,{value:t,onValueChange:b,children:[e.jsx(z,{id:"reason",className:"w-full bg-input border-border",children:e.jsx(A,{placeholder:"Bir neden seçin..."})}),e.jsx(E,{className:"dropdown-content",children:P.map(a=>e.jsx(C,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"details",className:"font-medium",children:"Detaylar (İsteğe Bağlı)"}),e.jsx(R,{id:"details",placeholder:"Şikayetinizle ilgili ek bilgi verin...",value:d,onChange:a=>j(a.target.value),className:"min-h-[120px] bg-input border-border"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-3",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>i(-1),disabled:o,className:"flex-1 border-muted-foreground/50 text-muted-foreground hover:bg-muted-foreground/10",children:"İptal"}),e.jsxs(x,{type:"submit",disabled:o||!t||t==="Diğer"&&!d.trim(),className:"flex-1 btn-primary text-primary-foreground",children:[o?e.jsx(k,{className:"w-4 h-4 mr-2 animate-pulse"}):e.jsx(k,{className:"w-4 h-4 mr-2"}),"Şikayeti Gönder"]})]})]})]})};export{J as default};
